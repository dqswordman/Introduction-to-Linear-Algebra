# CHAPTER 4

![image-20250804043708991](./assets/image-20250804043708991.png)

第四章 · 正交性（Orthogonality）总览
==========================

本节内容概述了向量与子空间之间“正交”这一核心概念，并引出投影、最小二乘、正交矩阵、Gram–Schmidt 正交化及矩阵伪逆等多个后续主题。理解本章不仅能够澄清 _Ax=b_ 与 _A^T y = 0_ 的几何含义，还为后续学习最小二乘与数值线性代数奠定基础。

* * *

1 向量与子空间的正交性
------------

### 1.1 向量正交

*   **定义**  
    两个向量  $\mathbf v,\mathbf w$  的点积为零即称正交：
    $$
    \mathbf v\cdot\mathbf w \;=\; \mathbf v^{\mathsf T}\mathbf w \;=\;0.
    $$
*   **毕达哥拉斯（Pythagoras）等式**
    $$
    \lVert\mathbf v\rVert^2+\lVert\mathbf w\rVert^2 \;=\; \lVert\mathbf v+\mathbf w\rVert^2,
    $$
    当且仅当  $\mathbf v^{\mathsf T}\mathbf w = 0$  成立。它把几何中的直角三角形关系用向量语言表达出来，是正交概念的代数特征。

### 1.2 正交子空间

*   **四大基本子空间复习**
    *   列空间  $C(A)$ 
    *   零空间  $N(A)$ 
    *   行空间  $C(A^{\mathsf T})$ 
    *   左零空间  $N(A^{\mathsf T})$ 
*   **正交配对**
    $$
     \boxed{N(A) \;\perp\; C(A^{\mathsf T})}, \qquad \boxed{N(A^{\mathsf T}) \;\perp\; C(A)}.
    $$
    > *    $Ax=0\Rightarrow x$  与每一行正交。
    > *    $A^{\mathsf T}y=0\Rightarrow y$  与每一列正交。
    >     

* * *

2 投影与最小二乘近似
-----------

### 2.1 投影的几何意义

给定向量  $\mathbf b$  不在列空间时，需找到其在列空间上的最“近”点  $\mathbf p$ ，使

$$
\mathbf e = \mathbf b-\mathbf p
$$

与列空间正交。此  $\mathbf p$  称为 **正交投影**， $\mathbf e$  是残差。

### 2.2 最小二乘方程

推导正交条件  $\mathbf e\perp C(A)$  得

$$
A^{\mathsf T}\mathbf e = 0 \;\;\Longrightarrow\;\; A^{\mathsf T}A\hat{\mathbf x}=A^{\mathsf T}\mathbf b,
$$

其中  $\hat{\mathbf x}$  为最小化  $\lVert A\mathbf x-\mathbf b\rVert^2$  的解， $\mathbf p=A\hat{\mathbf x}$ 。

*   若  $A$  列向量已正交且单位化( $A^{\mathsf T}A=I$ )，则
    $$
    \hat{\mathbf x}=A^{\mathsf T}\mathbf b, \qquad \mathbf p = AA^{\mathsf T}\mathbf b.
    $$
    说明“正交列”大大简化最小二乘计算。

* * *

3 正交矩阵与 QR 分解
-------------

### 3.1 正交矩阵

矩阵  $Q$  满足

$$
Q^{\mathsf T}Q = QQ^{\mathsf T}=I
$$

即列向量、行向量两两正交且单位长度。性质：

*   **旋转/反射**：保持向量长度与夹角。
*   **逆等于转置**：  $\,Q^{-1}=Q^{\mathsf T}$ 。

### 3.2 Gram–Schmidt 正交化

*   依次将基向量  $\mathbf a_1,\dots,\mathbf a_n$  正交化并单位化，得到
    $$
    Q=[\mathbf q_1,\dots,\mathbf q_n], \quad R_{ij}=\mathbf q_i^{\mathsf T}\mathbf a_j,\; i\le j.
    $$
*   **QR 分解**
    $$
    A = QR, \qquad Q^{\mathsf T}Q=I,\; R\text{ 上三角}.
    $$
    QR 是最小二乘的数值核心： $\hat{\mathbf x}=R^{-1}Q^{\mathsf T}\mathbf b$ 。

* * *

4 伪逆（Pseudoinverse）概念前瞻
-----------------------

*   当  $A$  非满秩或非方阵时， $A^{\mathsf T}A$  可能不可逆；伪逆  $A^{+}$  则提供
    $$
    \hat{\mathbf x}=A^{+}\mathbf b
    $$
    的最小二乘最小范数解。
*   伪逆可通过 **SVD** 或 **正交投影** 理解，本章后续节将深入展开。

* * *

5 小结
----

1.  **正交的核心**：点积为零导致几何直角与代数独立性统一。
2.  **四维视角**：零空间与行空间、左零空间与列空间呈正交关系。
3.  **投影→最小二乘**：将“不在子空间”分解为“在+垂直”，导出正规方程。
4.  **正交矩阵的价值**：数值稳定、易逆、简化正规方程。
5.  **QR 与 Gram–Schmidt**：构造正交基并得到简洁的上三角结构，是最小二乘与伪逆计算的基石。



![image-20250804043721338](./assets/image-20250804043721338.png)

4.1 向量与子空间的正交性
==============

> **本节定位**：本小节给出了“正交”概念的五条核心定理，并以矩阵  $A$  的行空间、列空间与零空间为例，展示了正交思想如何将“几何直角”推广到高维线性代数；同时揭示了维数互补、向量组独立性与张成关系间的深层联系。

* * *

1 五条核心定理逐条解析
------------

| # | 原文要点 | 中文拆解与补充 |
| --- | --- | --- |
| **1** | **向量正交**： $\mathbf v^{\mathsf T}\mathbf w=0$  ⟹  $\lVert\mathbf v\rVert^{2}+\lVert\mathbf w\rVert^{2}=\lVert\mathbf v+\mathbf w\rVert^{2}$  |   
• 点积为零即“直角”  
• 推出毕达哥拉斯定理： $\lVert\mathbf v+\mathbf w\rVert$  为斜边长度；代数等式刻画几何直角  
• 若向量组两两正交，可直接用模平方相加计算合向量长度（常见于傅里叶级数、信号能量守恒） |
| **2** | **子空间正交**：若  $\forall \mathbf v\in V, \mathbf w\in W$ ，均有  $\mathbf v^{\mathsf T}\mathbf w=0$  则称  $V\perp W$  | • 推广“向量直角”到“平面⊥线、平面⊥平面”等高维情形  
• 正交子空间交集仅含零向量 |
| **3** | **矩阵四大空间中的正交**：行空间 $C(A^{\mathsf T})$  与零空间 $N(A)$ 正交；列空间 $C(A)$  与左零空间 $N(A^{\mathsf T})$ 正交 | • 口诀：**行⊥零，列⊥左零**  
• 解释： $Ax=0$  ⇒ 每行  $\mathbf r_i$  都满足  $\mathbf r_i^{\mathsf T}\!x=0$ ，故零空间与所有行组合（行空间）正交；同理列/左零 |
| **4** | **维数互补**：若  $V\perp W$  且  $\dim V=r$ ，则  $\dim V + \dim W =$  空间维度 | • 证明依赖于直和分解： $\mathbb R^n = V\oplus W$   
• 在矩阵情形： $\dim C(A^{\mathsf T})=r,\ \dim N(A)=n-r$  |
| **5** | **独立⇔张成 (满维情形)**：在  $\mathbb R^n$  中， $n$  个向量**独立** ⇔ 它们**张成整个  $\mathbb R^n$ ** | • 线性代数第一章出现过，此处复习；结合 Gram–Schmidt 可将独立组转化为正交基 |

* * *

2 毕达哥拉斯等式的推导
------------

$$
\lVert\mathbf v+\mathbf w\rVert^{2} =(\mathbf v+\mathbf w)^{\mathsf T}(\mathbf v+\mathbf w) =\underbrace{\mathbf v^{\mathsf T}\mathbf v}_{\lVert\mathbf v\rVert^{2}} +\underbrace{\mathbf w^{\mathsf T}\mathbf w}_{\lVert\mathbf w\rVert^{2}} +\cancelto{0}{\mathbf v^{\mathsf T}\mathbf w} +\cancelto{0}{\mathbf w^{\mathsf T}\mathbf v} .
$$

正交导致交叉项消失，故得平方和公式。

* * *

3 行空间与零空间正交性的矩阵证明
-----------------

### 3.1 “元素级”视角

设

$$
A=\begin{bmatrix}\text{row 1}\\ \vdots \\ \text{row m}\end{bmatrix}, \qquad Ax =\begin{bmatrix} \text{row 1}\cdot x\\[-1pt] \vdots\\[-1pt] \text{row m}\cdot x \end{bmatrix} =\mathbf 0.
$$

若  $x\in N(A)$ ，则每一行与  $x$  的点积都为 0，故任意行的**线性组合**（即行空间中的向量）都与  $x$  正交。

### 3.2 “列向量”视角（更常用）

对任意  $y\in\mathbb R^{m}$ ，行空间的典型向量可写成  $A^{\mathsf T}y$ 。

$$
x^{\mathsf T}(A^{\mathsf T}y)=(Ax)^{\mathsf T}y = \mathbf 0^{\mathsf T}y = 0,
$$

因此  $x\perp A^{\mathsf T}y$ ，证毕。

> **小提醒**：此证明同时说明  $N(A^{\mathsf T})\perp C(A)$ ，只需把  $A$  换成  $A^{\mathsf T}$ 。

* * *

4 维数互补与秩–零度定理
-------------

*   对于  $m\times n$  矩阵  $A$ ，
    $$
    \dim N(A)=n-r,\qquad \dim C(A^{\mathsf T})=r
    $$
    严格满足  $n-r+r=n$ 。
*   **几何含义**： $\mathbb R^{n}$  被拆为行空间的“正交帽子”＋零空间，彼此无交且无缺口。
*   **实用价值**：计算零空间维数无需手动求基，只要知道秩  $r$ 。

* * *

5 独立性与张成的互逆
-----------

> **定理 5 回顾**：在  $n$  维空间，若  $n$  个向量互相独立，则不存在“缺维”，它们必然张成  $\mathbb R^{n}$ ；反向亦然。

*   与 Gram–Schmidt 联动：独立组可正交化→得到一组 **正交基**；此基为数值计算和几何解释提供便利。
*   与最小二乘联动：如果列向量独立（满秩），则正规方程  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  有唯一解。

* * *

6 与上一张课件的衔接
-----------

上一张总览强调了“四大子空间”及最小二乘，这里进一步**形式化了正交概念的五条公理级定理**，并给出**行/列空间与零空间**互补与正交的严格证明。掌握本节后，可更轻松理解后续的**投影矩阵、QR 分解**和 **伪逆**。

* * *

7 小结
----

1.  **点积零 = 直角**：从向量延伸至子空间。
2.  **行⊥零，列⊥左零**：矩阵四大空间的正交配对。
3.  **维数互补**：秩决定了零空间维数，空间被正交拆分完毕。
4.  **独立⇔张成（满维）**：连接向量组代数属性与几何覆盖。
5.  理论工具服务实践——后续最小二乘与数值稳定算法皆以此为基石。



![](./assets/image-20250804043804846.png)

## ![image-20250804043732233](./assets/image-20250804043732233.png)
正交子空间的维数与分解——四大子空间定理 · Part 2
=============================

> **本次内容范围**：课件示例 1、维数限制定理、正交补（orthogonal complement）概念、四大子空间基本定理（Fundamental Theorem of Linear Algebra, Part 2）及示例 2（可逆子矩阵）。

* * *

1 示例 1：用具体矩阵演示行空间 ⟂ 零空间、列空间 ⟂ 左零空间
----------------------------------

### 1.1 行空间与零空间

给定

$$
A=\begin{bmatrix} 1&-2& 1\\ 1& 0&-1 \end{bmatrix},\qquad x=\begin{bmatrix}1\\1\\1\end{bmatrix},
$$

计算

$$
Ax=\begin{bmatrix} 1(-2)+1=0\\ 1+0-1=0 \end{bmatrix}.
$$
*   **结论**：向量  $x$  在  $N(A)$  中，与 **每一行** 正交；因此与 **行空间** 中任意向量均正交。

### 1.2 列空间与左零空间

同样，令

$$
y=\begin{bmatrix}0\\0\end{bmatrix}\in N(A^{\mathsf T}), \qquad A^{\mathsf T}y= \begin{bmatrix} 1& 1\\ -2& 0\\ 1&-1 \end{bmatrix} \!\!\begin{bmatrix}0\\0\end{bmatrix} =\mathbf 0.
$$
*   **结论**： $y$  对列空间  $C(A)$  中的所有列矢量正交。

> 这是“四大空间”正交性在**具体 2×3 矩阵**上的极端例子：
> 
> *    $C(A)=\mathbb R^{2}$ （行空间全占），
> *    $N(A^{\mathsf T})=\{\mathbf 0\}$ （左零空间只有零向量）。
>     

* * *

2 维数限制定理与正交补
------------

### 2.1 正交子空间维数上界

若  $V,W\subset\mathbb R^{n}$  且  $V\perp W$ ，则

$$
\boxed{\dim V+\dim W\le n}.
$$
*   几何直观：在三维空间中，**墙面**与**地面**各是 2-维，但它们交于一条线（1-维），故二者**不可能**彼此正交。

### 2.2 正交补 (Orthogonal Complement)

当  $V\perp W$  且  $\dim V+\dim W=n$  时， $W$  称为  $V$  的正交补  $V^{\perp}$ 。

| 正交互补对 | 维数关系 |
| --- | --- |
| 行空间  $C(A^{\mathsf T})$  与零空间  $N(A)$  |  $r+(n-r)=n$  |
| 列空间  $C(A)$  与左零空间  $N(A^{\mathsf T})$  |  $r+(m-r)=m$  |

* * *

3 基本定理 · Part 2 —— 90° 角度版
--------------------------

> **结论**
> 
> $$
> \boxed{N(A)=C(A^{\mathsf T})^{\perp}\subset\mathbb R^{n}},\qquad \boxed{N(A^{\mathsf T})=C(A)^{\perp}\subset\mathbb R^{m}}.
> $$

### 3.1 图 4.1 解读

*   **左侧**  $ \mathbb R^{n}$ ：
    *   行空间分量  $x_r$  投射到右侧为  $Ax_r=b$ 。
    *   零空间分量  $x_n$  经  $A$  映射为零（虚线）。
*   **右侧**  $ \mathbb R^{m}$ ：
    *   列空间包含所有可能的  $Ax$ 。
    *   左零空间与列空间正交。

> **最小范数解**：当  $Ax=b$  可解时，长度最小的解为纯行空间分量  $x_r$ ，因为任何额外的  $x_n$  只会增加范数  $\lVert x\rVert$ 。

### 3.2 “A 内部隐藏的可逆矩阵”

删去两零空间，“行空间→列空间”部分是一个满秩  $r\times r$  可逆映射。

*   **伪逆  $A^{+}$ ** 将在 4.5 节把列空间 **映回** 行空间，恢复这一可逆性。

* * *

4 示例 2：秩 r 矩阵含 r×r 可逆子矩阵
------------------------

对秩  $r=2$  的

$$
A=\begin{bmatrix} 1&2&3&4&5\\ 1&2&4&5&6\\ 1&2&4&5&6 \end{bmatrix},
$$

可在**主元行/列**处找到

$$
\begin{bmatrix} 1&3\\ 1&4 \end{bmatrix}
$$

为 2×2 可逆子矩阵。

*   **原因**：
    *   秩  $r$  → 存在  $r$  个线性无关列。
    *   同理  $A^{\mathsf T}$  有  $r$  个无关列 ⇒  $A$  有  $r$  个无关行。
    *   取这  $r$  行  $r$  列交叉处即得可逆子矩阵。
*   **延伸**：此子矩阵对应主元，和 **LU/QR 分解 pivot 选择**原理一致。

* * *

5 高亮细节与推导
---------

1.  **维数=直角+直和**
    $$
    x = x_r + x_n,\quad \lVert x\rVert^2=\lVert x_r\rVert^2+\lVert x_n\rVert^2
    $$
    行空间与零空间正交确保勾股分解在  $\mathbb R^{n}$  成立。
2.  **唯一性**
    *   若  $b$  在列空间，则存在**唯一**行空间向量  $x_r$  使  $Ax_r = b$ 。
    *   若  $b$  不在列空间，则需引入投影与最小二乘（上一小节）。
3.  **正交补与算法设计**
    *   求  $N(A)$  可用 **行约简**；求  $N(A^{\mathsf T})$  则对  $A^{\mathsf T}$  行约简或对  $A$  列约简。
    *   **数值稳定** 的 QR/SVD 均利用正交结构，保证误差不被放大。

* * *

6 与前两张课件的衔接
-----------

*   **图一（正交定义）→ 图二（行⊥零推导）→ 图三/四（维数与补空间）**：  
    本次两张图片正好补全了“行/列-零空间正交”在 **实例矩阵** 和 **抽象维数理论** 两个层面的展示，并引出了伪逆与子矩阵可逆性，为后续 **最小二乘数值解** 与 **QR、SVD** 铺路。

* * *

7 小结
----

*   行空间  $C(A^{\mathsf T})$  与零空间  $N(A)$  互为正交补，列空间  $C(A)$  与左零空间  $N(A^{\mathsf T})$  亦然。
*   正交子空间维数之和不超过空间维度；等号成立时互为正交补。
*   基本定理 Part 2 将“维数”与“正交”两幅图完美拼合，给出了  $Ax=b$  全体解的几何分解。
*   任意秩  $r$  矩阵都包含 r×r 的可逆子矩阵，为后续分解算法提供理论保证。



![image-20250804043829074](./assets/image-20250804043829074.png)

基的组合、可逆性的判据与行-零分解
=================

（对应课件页：“Combining Bases from Subspaces”，含例 3、例 4）

* * *

一、**为什么“够多且互不相关”就能“铺满空间”**
--------------------------

> **核心结论**
> 
> 1.  在  $\mathbb R^{n}$  中，任取  $n$  个**线性无关**向量 ⇒ 必定 **张成**  $\mathbb R^{n}$ 。
> 2.  任取  $n$  个向量若能 **张成**  $\mathbb R^{n}$  ⇒ 必定 **线性无关**。
>     

*   **直观理解**：  
    “无冗余”+“数量够” ⇒ 没有留白；  
    “张成全部”+“数量刚好” ⇒ 不存在多余。
*   **代数落点**：当这  $n$  个向量是方阵  $A$  的列时：
    $$
    \text{列独立}\;\Longleftrightarrow\;\text{列张成 } \mathbb R^{n} \;\Longleftrightarrow\;A\text{ 可逆}.
    $$

* * *

二、**方阵可逆的三组等价条件**（盒内三条）
-----------------------

| 判据 | 推出 | 逆向 |
| --- | --- | --- |
| **列独立** |  $Ax=b$  至少可解 | 若对每个  $b$  都仅有唯一解 ⇒ 列独立 |
| **列张成  $\mathbb R^{n}$ ** |  $Ax=b$  对任意  $b$  **存在**解 | 存在解 + 唯一解 ⇒ 可逆 |
| **存在逆矩阵**  $AB=I$  | 立即得  $A^{-1}=B$  且  $BA=I$  |  |

*   **“存在 ⇔ 唯一”双向链**
    *   **唯一⇒存在**：回代保证求得解。
    *   **存在⇒唯一**：无自由变量 ⇒ 零空间仅含  $\mathbf 0$ 。

* * *

三、**行空间  $+$  零空间 = 全空间**
-------------------------

*   行空间维数  $r$ ，零空间维数  $n-r$  ⇒ **总计  $n$  个基向量**。
*   这些向量互相独立（脚注 ¹ 证明），因此它们也张成  $\mathbb R^{n}$ 。
*   **分解公式**
    $$
    x = x_r + x_n,\qquad x_r\in C(A^{\mathsf T}),\; x_n\in N(A).
    $$

* * *

四、**例 3：手算行-零分解**
-----------------

给

$$
A=\begin{bmatrix}1&2\\3&6\end{bmatrix},\qquad x=\begin{bmatrix}4\\3\end{bmatrix}.
$$
*   **行空间向量**  $x_r=(2,4)^{\mathsf T}$  满足行关系。
*   **零空间向量**  $x_n=(2,-1)^{\mathsf T}$  使  $Ax_n=\mathbf 0$ 。
*   **验证**： $x = x_r + x_n = (2,4)+(2,-1)$ 。
*   **后续**：下一节将用投影矩阵  $P$  计算  $x_r,P=P^2=P^{\mathsf T}$ 。

* * *

五、**例 4：9 维空间中 6 维子空间  $S$  的几何提问**
-----------------------------------

设  $\dim S = 6\subset \mathbb R^{9}$ 。

| 问题 | 答案 | 说明 |
| --- | --- | --- |
| (a) 与  $S$  正交的任意子空间维数可取？ | 0, 1, 2, 3 | 受上界  $\le 3$  限制（正交补维数 3）。 |
| (b) 正交补  $S^{\perp}$  的维数？ | **3** | 由  $\dim S+\dim S^{\perp}=9$ 。 |
| (c) 行空间为  $S$  的最小矩阵尺寸？ | ** $6\times 9$ ** | 需秩 6 ⇒ 至少 6 行、9 列。 |
| (d) 零空间为  $S^{\perp}$  的最小矩阵尺寸？ | ** $6\times 9$ ** | 需 nullity 3 ⇒ 秩 6，同样最简 6×9。 |

* * *

六、**要点归纳**
----------

1.  **基的双条件**在“够多且无冗余”时自动互推。
2.  **可逆判据**把“列独立/张成”“解存在唯一”“左右逆”等统一成一张网。
3.  **行-零分解**展示了正交补思想： $\mathbb R^{n}=C(A^{\mathsf T})\oplus N(A)$ 。
4.  **维数限制**：正交子空间维数之和 ≤ 空间维度；等号时即正交补。
5.  **构造矩阵**：给定子空间常用“行张成/零空间”方法确定最小行数与列数。



![image-20250804043839803](./assets/image-20250804043839803.png)

![image-20250804043848384](./assets/image-20250804043848384.png)

4.2 线与子空间上的正交投影
===============

本节聚焦“投影矩阵”这一工具：**把任意向量  $b$  分解为“在子空间内”的最近点  $p$  与“垂直于子空间”的误差  $e$ **。掌握本节即可熟练处理最小二乘、数据降维及图形学中的投影运算。

* * *

1 关键命题逐条拆解
----------

| # | 原文条目 | 中文解析与补充 |
| --- | --- | --- |
| **1** | 线  $a$  上的投影： $p = a\,\dfrac{a^{\mathsf T}b}{a^{\mathsf T}a}$  | • 公式与“一维最小二乘”一致。  
• 分母  $a^{\mathsf T}a=\lVert a\rVert^{2}$  保证标量缩放正确。 |
| **2** | 误差  $e = b-p$  与  $a$  垂直，三角形  $bpe$  右角成立 | • 勾股公式： $\lVert p\rVert^{2}+\lVert e\rVert^{2}=\lVert b\rVert^{2}$ 。 |
| **3** | 投影到子空间  $S$ ： $p\in S$ ，且  $e=b-p\perp S$  | • “最近点”=“垂直误差” 等价条件。  
• 适用于任意维数的子空间。 |
| **4** | 当  $A$  列独立时， $A^{\mathsf T}A$  可逆（且对称） | • Null $A^{\mathsf T}A$ \=Null $A$ ；秩保持。 |
| **5** | 投影到列空间  $C(A)$ ： $p = A(A^{\mathsf T}A)^{-1}A^{\mathsf T}b$  | • 先解正规方程  $A^{\mathsf T}A x = A^{\mathsf T}b$ ，再乘回  $A$ 。 |
| **6** | **投影矩阵**  $P = A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$  | • 对称： $P^{\mathsf T}=P$ 。  
• 幂等： $P^{2}=P$ 。  
• 将任何输入再次投影不会改变结果。 |

* * *

2 投影矩阵示例：三维空间中的线与平面
-------------------

### 2.1 题目与答案

*   **向量**： $b=(2,3,4)$ 。
*   **z 轴投影  $p_1$ **： $(0,0,4)$ 。
*   **xy 平面投影  $p_2$ **： $(2,3,0)$ 。

> 验证： $p_1+p_2=b$ ，且  $p_1\perp p_2$ 。

### 2.2 对应投影矩阵

$$
P_1= \begin{bmatrix} 0&0&0\\ 0&0&0\\ 0&0&1 \end{bmatrix}, \qquad P_2= \begin{bmatrix} 1&0&0\\ 0&1&0\\ 0&0&0 \end{bmatrix}.
$$
*   性质： $P_1P_2=0,\ P_1+P_2=I$ 。
*   维数：rank $P_1$ \=1（线），rank $P_2$ \=2（平面）。二者为 **正交互补**，维数和  $1+2=3$ 。

### 2.3 图 4.2 解析

*   直线 + 平面互为直角、维数互补 ⇒ **正交补** 概念的具体三维可视化。
*   虚线箭头展示  $b$  被拆为两条垂直分量，直观体现  $P_1+P_2=I$ 。

* * *

3 一般子空间的投影矩阵构造流程
----------------

1.  **取基向量做列**：若子空间  $S$  的一组基为列矩阵  $A\in\mathbb R^{m\times n}$ （列独立）。
2.  **计算正规方程矩阵**： $A^{\mathsf T}A$  是  $n\times n$  可逆矩阵。
3.  **公式**：
    $$
    P = A\bigl(A^{\mathsf T}A\bigr)^{-1}A^{\mathsf T}.
    $$
    *   若  $S$  为一条线 ⇒  $A$  仅 1 列 ⇒ rank $P$ \=1。
    *   若  $S$  为平面 ⇒  $A$  两列 ⇒ rank $P$ \=2。
4.  **检验**： $P^2=P,\ P^{\mathsf T}=P$  是“投影矩阵身份”。

> 课件列举三种  $A$ ：
> 
> $$
> A_1=\begin{bmatrix}0\\0\\1\end{bmatrix},\; A_2=\begin{bmatrix}1&0\\0&1\\0&0\end{bmatrix},\; A_3=\begin{bmatrix}1&2\\2&3\\0&0\end{bmatrix},
> $$
> 
> 它们都张成同一 xy 平面；不同基向量给出**同一个** rank-2 投影矩阵  $P$ （列空间只由“张成”决定，与基选取无关）。

* * *

4 与最小二乘的联系
----------

*   **正规方程**  $(A^{\mathsf T}A)x=A^{\mathsf T}b$  实质是在求最小二乘解的坐标  $x$ 。
*   求得  $x$  后的预测  $\hat b = Ax$  就是 **投影**  $p$ 。
*   若列向量已正交且单位 ⇒  $A^{\mathsf T}A=I$ ，则  $P=AA^{\mathsf T}$  形式最简单。

* * *

5 小结
----

1.  投影 = “最近点”⇔“垂直误差”。
2.  投影矩阵  $\boxed{P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}}$ ：对称、幂等。
3.  线与平面的经典例子演示了  $P_1+P_2=I$  与正交补。
4.  构造投影矩阵只需子空间基；基不同， $P$  不变。
5.  正规方程与投影本质相同，是最小二乘问题的代数核心。



![image-20250804043856590](./assets/image-20250804043856590.png)

![image-20250804043902265](./assets/image-20250804043902265.png)

4.2.1 向量在一条直线上的投影（Projection Onto a Line）
=========================================

> **承接**：上一节给出一般子空间投影公式，本页聚焦“向量投影到单一方向  $a$ ”的全过程，并通过两个数值例子巩固 **投影向量**、**误差向量** 与 **投影矩阵** 的推导与性质。

* * *

1 推导步骤三连： $\hat x$  →  $p$  →  $P$ 
-----------------------------------

1.  **设定比例因子**
    $$
    p=\hat x\,a,\quad \text{其中比例 }\hat x=\frac{a^{\mathsf T}b}{a^{\mathsf T}a}.
    $$
    *   由正交条件  $a^{\mathsf T}(b-\hat x a)=0$  解得。
2.  **得到投影向量**
    $$
    p=\frac{a^{\mathsf T}b}{a^{\mathsf T}a}\,a.
    $$
3.  **抽象成投影矩阵**
    $$
    P=\frac{aa^{\mathsf T}}{a^{\mathsf T}a},\qquad p=Pb.
    $$
    *   **秩 1**：仅沿  $a$  一维。
    *   **对称**： $P^{\mathsf T}=P$ 。
    *   **幂等**： $P^{2}=P$ 。
    *   **不随  $a$  缩放而改变**（因为缩放抵消于分母）。

* * *

2 几何解释（图 4.3）
-------------

*   **实线**：从原点到  $b$ 。
*   **虚线**：误差  $e=b-p$ ，与  $a$  垂直。
*   **直角三角形**： $\lVert b\rVert^{2}=\lVert p\rVert^{2}+\lVert e\rVert^{2}$ 。
*   **推广**：当用多列矩阵  $A$  替代单列  $a$  时，流程升级为正规方程与投影矩阵  $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$ 。

* * *

3 数值验证
------

### 例 1：  $b=(1,1,1)^{\mathsf T}$ ，  $a=(1,2,2)^{\mathsf T}$ 

| 计算项 | 结果 |
| --- | --- |
|  $a^{\mathsf T}b$  |  $1+2+2 = 5$  |
|  $a^{\mathsf T}a$  |  $1+4+4 = 9$  |
|  $\hat x =\dfrac{5}{9}$  | — |
| **投影**  $p=\dfrac{5}{9}a$  |  $\bigl(\tfrac{5}{9},\tfrac{10}{9},\tfrac{10}{9}\bigr)^{\mathsf T}$  |
| **误差**  $e=b-p$  |  $\bigl(\tfrac{4}{9},-\tfrac{1}{9},-\tfrac{1}{9}\bigr)^{\mathsf T}$  |
| 验证  $e^{\mathsf T}a$  |  $0$ （垂直） |

### 例 2： 构造投影矩阵  $P$  并再次验证

$$
P=\frac{aa^{\mathsf T}}{a^{\mathsf T}a} =\frac1{9} \begin{bmatrix} 1&2&2\\ 2&4&4\\ 2&4&4 \end{bmatrix}.
$$
*   **再投影**： $p=Pb$  → 同例 1 结果。
*   **性质检查**：
    *    $P^{2}=P$ （幂等）。
    *   对角线和  $\tfrac{1}{9}(1+4+4)=1$ 。
    *   误差  $e=(I-P)b$  与  $p$  正交： $e^{\mathsf T}p=0$ 。
    *    $I-P$  投影到 **正交补平面**（垂直于  $a$ ）。

* * *

4 启示与推广
-------

1.  **一维投影** ⇢ 正规方程的简化版： $\hat x=\dfrac{a^{\mathsf T}b}{a^{\mathsf T}a}$ 。
2.  **矩阵视角统一**：秩 1 投影矩阵是一般投影公式  $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$  在  $n=1$  情况的特例。
3.  **双投影互补**： $P$  与  $I-P$  分别投影到子空间及其正交补；在前页例子中体现为 z 轴与 xy 面。
4.  **数值稳定性**：若先将  $a$  单位化（ $\lVert a\rVert=1$ ），则  $P=aa^{\mathsf T}$  计算更简洁。

* * *

5 小结
----

*   投影 onto a line = **“沿方向  $a$  的最近点”**。
*   公式三步：求  $\hat x$  → 得  $p$  → 抽离矩阵  $P$ 。
*   投影矩阵 **对称 + 幂等 + 秩 1 + 不变于尺度**。
*   误差必垂直  $a$ ，且  $P\,+\,(I-P)=I$  完整分解任何向量。
*   该机制为高维投影、最小二乘与正交分解提供最基础模板。



![image-20250804044042432](./assets/image-20250804044042432.png)

![image-20250804044047667](./assets/image-20250804044047667.png)

**正交投影（二）：投影到 $n$ 维子空间的完整公式**
=============================

> _本节承接上一页“投影到直线”的内容，将公式推广到由 $n$ 个线性无关向量张成的子空间。重点是正规方程 $A^{\\mathsf T}A\\hat x=A^{\\mathsf T}b$，以及三大输出：最优系数 $\\hat x$、投影向量 $p$、投影矩阵 $P$。_

* * *

1\. 问题场景与符号约定
-------------

*   **基向量**：$;a\_1,\\dots,a\_n\\in\\mathbb R^{m}$ 线性无关
*   **子空间**：$S=C(A)=\\operatorname{span}{a\_1,\\dots,a\_n}$，其中 $A=\[a\_1,\\cdots,a\_n\]\\in\\mathbb R^{m\\times n}$
*   **目标**：对任意 $b\\in\\mathbb R^{m}$，找到
    $$
    p=A\hat x\quad(\,p\in S\,)
    $$
    使得 $\\lVert b-p\\rVert$ 最小（即 $p$ 是 $b$ 在 $S$ 上的**最近点**）。

* * *

2\. 误差正交条件 $;A^{\\mathsf T}(b-A\\hat x)=0$
------------------------------------------

1.  **几何关键**
    $$
    e=b-A\hat x\;\;\perp\;\;S \Longrightarrow a_i^{\mathsf T}e=0,\; i=1,\dots,n.
    $$
2.  **矩阵化**  
    将 $n$ 条点积方程堆叠可得
    $$
     A^{\mathsf T}(b-A\hat x)=0 \;\Longrightarrow\; A^{\mathsf T}A\hat x = A^{\mathsf T}b.
    $$
    这就是**正规方程**（4）。
3.  **可逆性保证**
    *   列独立 $\\Rightarrow A^{\\mathsf T}A$ 为对称正定矩阵，可逆。
    *   若 $n=1$，$A^{\\mathsf T}A$ 退化为标量 $a^{\\mathsf T}a$，与上一页公式一致。

* * *

3\. 投影三部曲公式（课件方框(5)(6)(7)）
--------------------------

| 步骤 | 公式 | 维度 | 说明 |
| --- | --- | --- | --- |
| **(5) 求系数 $\\hat x$** | $\\displaystyle \\boxed{\\hat x=(A^{\\mathsf T}A)^{-1}A^{\\mathsf T}b}$ | $n\\times1$ | 解正规方程 |
| **(6) 求投影 $p$** | $\\displaystyle \\boxed{p=A\\hat x=A(A^{\\mathsf T}A)^{-1}A^{\\mathsf T}b}$ | $m\\times1$ | $p$ ∈ 列空间 |
| **(7) 投影矩阵 $P$** | $\\displaystyle \\boxed{P=A(A^{\\mathsf T}A)^{-1}A^{\\mathsf T}}$ | $m\\times m$ | 对称、幂等、rank=$n$ |

* * *

4\. 与 $n=1$（直线投影）的对应
--------------------

*   将 $A$ 仅含一列 $a$ 时
    $$
    A^{\mathsf T}A=a^{\mathsf T}a\,(\text{标量}),\; \hat x=\frac{a^{\mathsf T}b}{a^{\mathsf T}a},\; P=\frac{aa^{\mathsf T}}{a^{\mathsf T}a},
    $$
    完全回到上一页(8)式。
*   **可见**：多维子空间投影只是把“标量除法”换成“矩阵求逆”。

* * *

5\. 误差向量与左零空间
-------------

1.  **误差**：$e=b-p=b-A\\hat x$
2.  **正交归宿**：$A^{\\mathsf T}e=0;\\Longrightarrow;e\\in N(A^{\\mathsf T})$
3.  **几何意义**：$\\mathbb R^{m}$ 被**正交分解**为
    $$
    b=p+e,\qquad p\in C(A),\;e\in N(A^{\mathsf T}).
    $$
    这与之前“行空间 ⟂ 零空间”完全平行，只是现在聚焦于列空间与左零空间。

* * *

6\. 公式落地示范（简述）
--------------

> _若给出具体 $A$ 与 $b$，按如下流程：_

1.  **构造** $A^{\\mathsf T}A$ 并求逆；
2.  **计算** $\\hat x=(A^{\\mathsf T}A)^{-1}A^{\\mathsf T}b$；
3.  **得到** 投影 $p=A\\hat x$ 与误差 $e=b-p$；
4.  **可选**：验证 $e^{\\mathsf T}p=0$、$P^{2}=P$、$P^{\\mathsf T}=P$。

* * *

7\. 小结
------

*   **正规方程** $A^{\\mathsf T}A\\hat x=A^{\\mathsf T}b$ 是高维投影的核心。
*   **投影矩阵** $P$ 把“求最近点”转化为一次矩阵乘法，且具备对称与幂等两大特性。
*   **误差向量** 位于 $N(A^{\\mathsf T})$，与列空间正交，实现了 $\\mathbb R^{m}$ 的直角分解。
*   **$n=1$ 特例** 完全包含于一般公式之中，体现公式统一性。



![image-20250804044112213](./assets/image-20250804044112213.png)

## ![image-20250804044119378](./assets/image-20250804044119378.png)
**投影到子空间的数值示例与  $A^{\mathsf T}A$  可逆性的充要条件**
============================================

> 本页结合 **Example 3** 的完整计算，说明如何实际求解正规方程、投影向量与投影矩阵；随后通过一个常见“拆错括号”警示，引出**定理： $A^{\mathsf T}A$  可逆 ⇔ 列向量线性无关**的严谨证明与反例对比。

* * *

1 Example 3：将  $b=(6,0,0)^{\mathsf T}$  投影到矩阵
---------------------------------------------

$$
A=\begin{bmatrix}1&0\\1&1\\1&2\end{bmatrix} \quad(\text{列向量 }a_1=(1,1,1)^{\mathsf T},\;a_2=(0,1,2)^{\mathsf T})
$$

的列空间

| 步骤 | 计算 | 结果与解释 |
| --- | --- | --- |
| **① 计算正规方程系数** |  $A^{\mathsf T}A=\begin{bmatrix}3&3\\3&5\end{bmatrix}$ ,  $A^{\mathsf T}b=\begin{bmatrix}6\\0\end{bmatrix}$  | 见(9)前 |
| **② 解正规方程** |  $\begin{bmatrix}3&3\\3&5\end{bmatrix}\!\hat x=\begin{bmatrix}6\\0\end{bmatrix}$  |  $\hat x=\begin{bmatrix}5\\-3\end{bmatrix}$  (公式 (9)) |
| **③ 得到投影  $p=A\hat x$ ** |  $p=5(1,1,1)^{\mathsf T}-3(0,1,2)^{\mathsf T}$  |  $p=(5,2,-1)^{\mathsf T}$  (公式 (10)) |
| **④ 误差向量** |  $e=b-p=(1,-2,1)^{\mathsf T}$  | 检查  $e^{\mathsf T}a_1=e^{\mathsf T}a_2=0$  → 垂直 |
| **⑤ 投影矩阵** | 用  $(A^{\mathsf T}A)^{-1}=\dfrac16\!\begin{bmatrix}5&-3\\-3&3\end{bmatrix}$  代入 |  $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}=\dfrac16\!\begin{bmatrix} 5&2&-1\\ 2&2&2\\ -1&2&5\end{bmatrix}$  (式 (11)) |
| **⑥ 验证** |  $Pb=b$  给出同样的  $p$ ；;  $P^2=P$  | 二次投影不变；对称幂等 |

> **几何结论**：向量  $b$  拆成
> 
> $$
> b=p+e,\quad p\in C(A),\; e\in N(A^{\mathsf T}),\; e^{\mathsf T}p=0.
> $$

* * *

2 常见错误警示： $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}\neq AA^{\mathsf T}(A^{\mathsf T})^{-1}$ 
-----------------------------------------------------------------------------------------

若误将  $(A^{\mathsf T}A)^{-1}$  “分拆”为  $A^{-1}(A^{\mathsf T})^{-1}$ ，看似可抵消出  $P=I$  —— **这是错误的**：

*   **原因 1**： $A$  为  $m\times n\,(m> n)$  **长矩阵**，无逆矩阵  $A^{-1}$ 。
*   **原因 2**：即使方阵， $(A^{\mathsf T}A)^{-1}\neq (A^{\mathsf T})^{-1}A^{-1}$ （两者次序不同、维度也不同）。

* * *

3 定理：   $\;A^{\mathsf T}A$  可逆 ⇔  $A$  列独立
------------------------------------------

> **命题** 对于任意  $m\times n$  矩阵  $A$ ，若列向量线性无关，则  $A^{\mathsf T}A$  **方阵、对称且可逆**；反之若列相关则奇异。

### 3.1 证明要点

1.  **零空间一致**：若  $x$  使  $A^{\mathsf T}Ax=0$  则
    $$
    \lVert Ax\rVert^{2}=x^{\mathsf T}A^{\mathsf T}Ax=0\Longrightarrow Ax=0.
    $$
    故 Null $(A^{\mathsf T}A)=$  Null $(A)$ 。
2.  **列独立 ⇔ Null $(A)=\{\mathbf 0\}$ **。因零空间仅含零向量 ⇒  $A^{\mathsf T}A$  无零特征值 ⇒ 可逆。
3.  **反例对比**（课件图表）：
    *   相关列  $\begin{bmatrix}1&2\\2&4\\0&0\end{bmatrix}$  ⇒  $A^{\mathsf T}A$  奇异。
    *   独立列  $\begin{bmatrix}1&2\\1&2\\2&1\end{bmatrix}$  ⇒  $A^{\mathsf T}A$  可逆。

* * *

4 速览总结
------

1.  **正规方程**  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  承载全部投影信息。
2.  **投影矩阵**  $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$  **对称 + 幂等 + rank =  $\!n$ **。
3.  **误差向量** 位于左零空间  $N(A^{\mathsf T})$ ，实现  $\mathbb R^{m}=C(A)\oplus N(A^{\mathsf T})$ 。
4.  **可逆性条件**：列独立 ⇔  $A^{\mathsf T}A$  可逆；此事实贯穿最小二乘与 QR 分解。
5.  **运算陷阱**：不可随意将  $(A^{\mathsf T}A)^{-1}$  “拆分”，矩阵维度与非可交换性需时刻留意。



![image-20250804044243259](./assets/image-20250804044243259.png)

# 第 4.2 节补充笔记：投影、最小二乘与卡尔曼更新示例

> 本页先回顾 **5 条核心投影公式**，随后通过 **3 个 Worked Example**（4.2 A / B / C）把「线投影 → 平面投影 → 动态平均」串成一线。阅读完下文，即使不看课本也能完整推导并举一反三。

------

## 一、关键公式回顾（5 条）

| #     | 公式                                                         | 直观含义                                      |
| ----- | ------------------------------------------------------------ | --------------------------------------------- |
| **1** | **线投影** $p=\hat a x=\dfrac{a^{\mathsf T}b}{a^{\mathsf T}a}a$ | 把向量 b 投到方向 a；比例系数由两者点积确定。 |
| **2** | **秩 1 投影矩阵** $P=\dfrac{aa^{\mathsf T}}{a^{\mathsf T}a}$ | 单次 $p=Pb$；再次 $P^2=P$。                   |
| **3** | **子空间投影误差** $e=b-p$ ⟂ 子空间                          | 投影后误差必垂直（最小二乘几何解释）。        |
| **4** | **满秩正规方程** $A^{\mathsf T}A\hat x=A^{\mathsf T}b$ ⇒ $\hat p=A\hat x$ | 当列满秩时唯一最小二乘解。                    |
| **5** | **一般投影矩阵** $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$     | 列不必正交；仍满足 $P^T=P,\;P^2=P$。          |

------

## 二、Worked Example 4.2 A —— 先投影到线再投影到平面

> **任务**：把 $b=(3,4,4)$ 先投影到线 $\ell:a=(2,2,1)$，再投影到与向量 $a^*=(1,0,0)$ 共张的平面 $\Pi=\operatorname{span}\{a,a^*\}$。

### 1. 线投影

$p_1=\frac{a^{\mathsf T}b}{a^{\mathsf T}a}a=\frac{18}{9}(2,2,1)=2a=(4,4,2).$

误差 $e_1=b-p_1=(-1,0,2)$ 与 a 满足点积 0。

### 2. 构造平面基矩阵

$A=[a\;a^*]=\begin{bmatrix}2&1\\2&0\\1&0\end{bmatrix},\quad A^{\mathsf T}A=\begin{bmatrix}9&2\\2&1\end{bmatrix},\; (A^{\mathsf T}A)^{-1}=\tfrac15\!\begin{bmatrix}1&-2\\-2&9\end{bmatrix}.$

### 3. 平面投影矩阵

$P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T} =\begin{bmatrix}1&0&0\\0&.8&.4\\0&.4&.2\end{bmatrix}.$

### 4. 平面投影结果

$p_2=Pb=(3,4.8,2.4),\quad e_2=b-p_2=(0,-.8,1.6)\;\perp\;a,a^*.$

e₂ 位于 $P$ 的零空间，因此再次投影仍得 0；$P^2=P=P^{\mathsf T}$ 检验成立。

------

## 三、Worked Example 4.2 B —— 单参数最小二乘 & 投影平均

> **情景**：脉搏分别测得 70, 80, 120 次 / 分，求“最佳”恒定脉搏 x。

### 1. 计算法（微分为零）

$E=(x-70)^2+(x-80)^2+(x-120)^2,\quad \frac{dE}{dx}=0\;\Rightarrow\;3x=70+80+120,\; \boxed{x=90}.$

### 2. 投影法

令 $a=(1,1,1)$，$b=(70,80,120)$。

$\hat x=\frac{a^{\mathsf T}b}{a^{\mathsf T}a}= \frac{270}{3}=90,$

与上法一致；几何上 b 被投影到线 $\operatorname{span}\{a\}$。

------

## 四、Worked Example 4.2 C —— “卡尔曼”式循环平均

> **设定**：已有前 999 次观测均值 $\hat x_{\text{old}}$，新值 $b_{1000}$ 到来。
>  **目标**：快速更新总体均值 $\hat x_{\text{new}}$。

### 推导

$\hat x_{\text{new}} =\frac{\sum_{i=1}^{999}b_i+b_{1000}}{1000} =\hat x_{\text{old}}+\frac1{1000}\bigl(b_{1000}-\hat x_{\text{old}}\bigr).$

可写作

$\boxed{\hat x_{\text{new}}=\hat x_{\text{old}}+K\,(b_{1000}-\hat x_{\text{old}})},\quad K=\tfrac1{1000}.$

- **gain K** 与卡尔曼滤波中的“更新增益”同型；此处因观测权重均等而为 1/1000。
- 迭代形式节省重复累加，数值稳定。

------

## 五、小结

1. **线 → 平面**：逐层投影的误差始终垂直于目标子空间。
2. **一维最小二乘** 恰等价于把观测向量投影到常数向量 (1,1,1)。
3. **递推平均** 可视为一次 rank-1 投影修正，思想与卡尔曼滤波完全吻合。

读到此处，你已掌握

- 投影矩阵构造 $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$、
- 多层投影误差正交性、
- 以及投影在实时数据更新中的应用。











![](./assets/image-20250804044305272.png)

## ![image-20250804044311316](./assets/image-20250804044311316.png)


4.3 最小二乘逼近（Least Squares Approximations）
========================================

> **定位**：上一节我们关注“投影向量”  $p=A\hat x$ ，本节聚焦“最小二乘解”  $\hat x$ 。当方程  $Ax=b$  **无解**（通常因为方程多、未知数少），我们通过正规方程  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  找到一条 **误差平方最小** 的折中曲线／平面／高维子空间。

* * *

1 核心要点逐条解析
----------

| # | 教材条目 | 中文拆解 |
| --- | --- | --- |
| **1** | 解决  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  可得投影  $p=A\hat x$ 。 | 与上一节投影公式完全一致： $\hat x$  给出最优坐标， $p$  给出列空间内的最近点。 |
| **2** | 若  $Ax=b$  无解，则  $\hat x$  称为“最小二乘解”，满足  $\lVert A\hat x-b\rVert^2$  最小。 |  $\lVert e\rVert$  最小化 ⇔ 误差向量与列空间正交。 |
| **3** | 令误差平方  $E=\lVert Ax-b\rVert^2$ ，取偏导  $\partial E/\partial x_i=0$  亦得到正规方程。 | 说明最小二乘从 **微积分视角** 也推导出同一条件。 |
| **4** | 拟合直线  $b=C+Dt$  至点  $(t_i,b_i)$  时， $A$  的两列为  $(1,\dots,1)$  与  $(t_1,\dots,t_m)$ 。 | 将数据拟合抽象为矩阵列：常数列 + 时间列。 |
| **5** | 此时  $A^{\mathsf T}A=\begin{bmatrix} m & \sum t_i\\ \sum t_i & \sum t_i^2 \end{bmatrix}$ ， $A^{\mathsf T}b=\begin{bmatrix}\sum b_i\\ \sum t_i b_i\end{bmatrix}$ 。 | 对称 2×2 系统，易手算；也是统计回归中“正态方程”的矩阵形式。 |

* * *

2 “方程无解”与最小二乘思想
---------------

*   **原因**：“未知数  $n$ ” < “方程数  $m$ ” → 列空间维度 <  $m$  → **一般**  $b\notin C(A)$ 。
*   **策略**：不再追求  $e=b-Ax=0$ ，而让  $\lVert e\rVert$  尽量小。
*   **数学化**：正规方程  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  仍是核心，给出最优  $\hat x$ 。

> ★ 口诀：  
> “**无解时，左乘  $A^{\mathsf T}$ ，求正规方程**。”

* * *

3 示例 1：三点拟合最优直线
---------------

### 3.1 问题建模

给点  $(0,6),(1,0),(2,0)$ ，找直线  $C+Dt$  最接近。

$$
A=\begin{bmatrix}1&0\\1&1\\1&2\end{bmatrix},\; x=\begin{bmatrix}C\\D\end{bmatrix},\; b=\begin{bmatrix}6\\0\\0\end{bmatrix}.
$$
*   **过拟合检查**：该  $3\times2$  系统 **无精确解**。   $\;b$  不是列组合。

### 3.2 正规方程计算

> _与上一页 Example 3 完全相同的数值_

$$
A^{\mathsf T}A=\begin{bmatrix}3&3\\3&5\end{bmatrix},\; A^{\mathsf T}b=\begin{bmatrix}6\\0\end{bmatrix}, \quad\Longrightarrow\quad \hat x=\begin{bmatrix}5\\-3\end{bmatrix}.
$$

### 3.3 最优直线 & 误差

*   **最佳直线**：  $\boxed{\,b\approx 5-3t\,}$ 。
*   **投影点**： $p=A\hat x=(5,2,-1)^{\mathsf T}$ 。
*   **误差向量**： $e=b-p=(1,-2,1)^{\mathsf T}$ ，与两列  $(1,1,1)$ 、 $(0,1,2)$  垂直。
*   **几何意义**：三点到直线距离平方总和  $\lVert e\rVert^2=1^2+(-2)^2+1^2=6$  最小。

> 若点数扩展至  $m=100$ ，矩阵大小变 ** $100\times2$ **，流程依旧：计算 2×2 的  $A^{\mathsf T}A$  与  $A^{\mathsf T}b$  即可。

* * *

4 最小二乘与投影的统一视角
--------------

| 概念 | 矢量 | 所在子空间 |
| --- | --- | --- |
| **预测值** |  $p=A\hat x$  | 列空间  $C(A)$  |
| **残差/误差** |  $e=b-p$  | 左零空间  $N(A^{\mathsf T})$  |
| **最小二乘解** |  $\hat x$  | 正规方程解 |
| **几何关系** |  $p\perp e$ ,  $\lVert b\rVert^{2}=\lVert p\rVert^{2}+\lVert e\rVert^{2}$  |  |

* * *

5 总结
----

1.  正规方程 ** $A^{\mathsf T}A\hat x=A^{\mathsf T}b$ ** 既给投影又给最小二乘。
2.  当 **方程超定**（ $m>n$ ）时，最小二乘为不可避免的折中。
3.  对数据拟合（如直线、二次曲线、平面）只需把样本点嵌入矩阵  $A$ 。
4.  误差属于  $N(A^{\mathsf T})$ ，与预测值正交。
5.  **一维 vs 多维拟合**：2×2 或更大尺寸的  $A^{\mathsf T}A$  皆可用同一解法，核心思想不变。



![](./assets/image-20250804044532715.png)

![](./assets/image-20250804044547778.png)

!![image-20250804045149852](./assets/image-20250804045149852.png)



**最小化误差——最小二乘的几何、代数与微积分统一视角**
=============================

（对应课件 _Minimizing the Error_ 与 Figure 4.6）

* * *

一、整体概述
------

本页延续上一节“最小二乘逼近”思路，进一步回答：**怎样让误差  $e=b-Ax$  尽可能小？**

*   **几何**：令误差向量  $e$  与列空间  $C(A)$  正交（ 90° ）。
*   **代数**：正规方程  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$ 。
*   **微积分**：最小化误差平方  $E=\|Ax-b\|^{2}$ ，使各偏导  $\partial E/\partial x_i=0$ 。

三种方法得出同一解  $\hat x$ ，并保证残差  $\|e\|$  最小。

* * *

二、三种角度的同步推导
-----------

### 1\. 几何视角

1.  **投影点**  $p=A\hat x$  位于列空间——如图 4.6 灰色平面。
2.  **误差向量**  $e=b-p$  与列空间垂直，满足
    $$
    A^{\mathsf T}e=0.
    $$
3.  **直角三角形**： $\|b\|^{2}=\|p\|^{2}+\|e\|^{2}$ 。

### 2\. 代数视角

*   正交条件  $A^{\mathsf T}(b-A\hat x)=0$  ⟹ 正规方程
    $$
    A^{\mathsf T}A\hat x=A^{\mathsf T}b. \tag{1}
    $$
*   求得  $\hat x$  后即可计算  $p$  与  $e$ 。

### 3\. 微积分视角

*   设
    $$
    E(x)=\|Ax-b\|^{2}=(Ax-b)^{\mathsf T}(Ax-b).
    $$
*   对每个分量取偏导：
    $$
    \frac{\partial E}{\partial x}=2A^{\mathsf T}(Ax-b)=0 \;\Longrightarrow\;A^{\mathsf T}A\hat x=A^{\mathsf T}b. \tag{2}
    $$
*   得到与 (1) 同一正规方程——说明几何、代数、微积分三路殊途同归。

* * *

三、示例再解析：三点拟合直线  $b = C + Dt$ 
-----------------------------

| 数据点  $t$  |  $b$  | 误差  $e_i$ （图 4.6 垂直距离） |
| --- | --- | --- |
| 0 | 6 | 1 |
| 1 | 0 | −2 |
| 2 | 0 | 1 |

*   **矩阵模型**
    $$
    A=\begin{bmatrix}1&0\\1&1\\1&2\end{bmatrix}, \quad x=\begin{bmatrix}C\\D\end{bmatrix}, \quad b=\begin{bmatrix}6\\0\\0\end{bmatrix}.
    $$
*   **正规方程**
    $$
    \underbrace{\begin{bmatrix}3&3\\3&5\end{bmatrix}}_{A^{\mathsf T}A} \hat x= \underbrace{\begin{bmatrix}6\\0\end{bmatrix}}_{A^{\mathsf T}b}.
    $$
    解得  $\hat x=(5,-3)^{\mathsf T}$ 。
*   **最佳直线**： $b=5-3t$ ；投影点  $p=(5,2,-1)^{\mathsf T}$ 。
*   **误差向量**： $e=(1,-2,1)^{\mathsf T}$ ，满足  $e^{\mathsf T}A=0$ ，且
    $$
    \|e\|^{2}=1^{2}+(-2)^{2}+1^{2}=6
    $$
    为所有可能解中的最小值。

> **观察**：误差分量之和  $1+(-2)+1=0$  并非巧合——它与第一列  $(1,1,1)$  正交。

* * *

四、公式 (3) 与偏导过程详解
----------------

将误差函数展开：

$$
E(C,D)= (C-6)^{2} + (C+D)^{2} + (C+2D)^{2}. \tag{3}
$$

计算偏导：

$$
\begin{aligned} \frac{\partial E}{\partial C} &= 2\big[(C-6)+(C+D)+(C+2D)\big] = 0,\\ \frac{\partial E}{\partial D} &= 2\big[(C+D)+1(C+2D)\cdot1+(C+2D)\cdot2\big]=0. \end{aligned}
$$

整理可得同一线性组

$$
\begin{cases} 3C+3D=6,\\ 3C+5D=0, \end{cases}
$$

即正规方程 (4)。解得  $C=5,\;D=-3$ 。

* * *

五、关键结论与学习要点
-----------

1.  **三视角统一**：正交条件 ↔ 正规方程 ↔ 偏导为零。
2.  **误差平方极小** ＝ **到列空间的投影**。
3.  **残差向量所属子空间**： $e\in N(A^{\mathsf T})$ 。
4.  **几何直观**：最小二乘把不可达的  $b$  “拉”到列空间最近点，形成直角三角形  $b,p,e$ 。
5.  **计算套路**：
    1.  列出  $A^{\mathsf T}A$  与  $A^{\mathsf T}b$ 。
    2.  解正规方程得  $\hat x$ 。
    3.  求  $p=A\hat x$  与  $e=b-p$ 。
    4.  如需误差大小，用  $\|e\|$  或  $\|e\|^{2}$ 。

* * *

六、本页小结
------

*   **最小二乘解**  $\hat x$  让误差平方  $E$  达到全局最小。
*   **正规方程** 是连接几何、代数、微积分的桥梁。
*   对于直线拟合，正规方程退化为 2×2 线性系统，可手算；数百点时依旧处理简洁。
*   记住：**“最小二乘 = 投影”** ——这是后续 QR 分解、SVD 与统计回归的理论基石。



## ![image-20250804044608678](./assets/image-20250804044608678.png)
最小二乘大图景（Figure 4.7）
===================

**概览**：Figure 4.7 将“矩阵 A 的四大子空间”重新排布，突出 **最小二乘** 情形下  $Ax=b$  无解时的几何与代数关系：

*   不再分解未知向量  $x=x_r+x_n$ ，而是分解观测向量  $b=p+e$ 。
*   目标是找到列空间内最接近  $b$  的点  $p=A\hat x$ ，并把无法避免的残差  $e$  推到左零空间  $N(A^{\mathsf T})$ 。

* * *

详细讲解
----

### 1\. 四大子空间回顾与角色互换

| 旧图（Figure 4.1） | 新图（Figure 4.7） | 变化 |
| --- | --- | --- |
| **求解  $Ax=b$ ** 有多解 | ** $Ax=b$ ** 无解 (  $m>n$  ) | 从“解的多样”到“解不存在” |
| 分解  $x=x_r+x_n$   
 $x_r\in C(A^{\mathsf T})$ ， $x_n\in N(A)$  | 分解  $b=p+e$   
 $p\in C(A)$ ， $e\in N(A^{\mathsf T})$  | 关注对象由未知量转到数据向量 |
| 关键方程  $Ax=b$  | 关键方程  $A\hat x=p$  与正规方程  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  | 引入最小二乘 |

> **注意**：行空间在最小二乘大图中依旧是  $\mathbb R^{n}$ （列独立 ⇒ 零空间仅含  $\mathbf 0$ ），因此正规方程有唯一解  $\hat x$ 。

### 2\. 图形解读

1.  **列空间（右侧平行四边形）**
    *   包含所有  $Ax$ ； $p=A\hat x$  位于其中。
    *   **箭头  $A\hat x=p$ ** 可解，因  $p\in C(A)$ 。
2.  **观测向量  $b$ **
    *   位于列空间外部（虚线指向列空间说明无解）。
    *   被分解为  $b=p+e$ 。
3.  **误差向量  $e$ **
    *   最小范数且位于  $N(A^{\mathsf T})$ 。
    *   与列空间垂直，形成直角。
4.  **维数条件**
    *    $m>n$  ⇒ 列空间维数不足以覆盖整个  $\mathbb R^{m}$ ，产生残差。

### 3\. 代数推导小结

*   **无解 → 正规方程**
    $$
    A^{\mathsf T}(b-Ax)=0\Longrightarrow A^{\mathsf T}A\hat x=A^{\mathsf T}b.
    $$
*   **最优投影**
    $$
    p=A\hat x = A(A^{\mathsf T}A)^{-1}A^{\mathsf T}b, \qquad e=b-p.
    $$
*   **误差最小律**
    $$
    \|Ax-b\|^{2}=\|p-b\|^{2}+\|Ax-p\|^{2}\ge\|e\|^{2},
    $$
    等号当且仅当  $x=\hat x$ 。

### 4\. 关键洞察

1.  **从“求解”到“逼近”**：若列空间不足，则“硬解”变“软逼近”。
2.  **投影思想贯穿**：最小二乘就是投影；正规方程就是投影条件。
3.  **四子空间互补**：
    *   列空间与左零空间正交。
    *   行空间与零空间正交。
    *   但在最小二乘图中，只显式用到前两者。
4.  **零空间缩影**：独立列 ⇒  $N(A)=\{\mathbf0\}$ ，因此正规方程唯一确定  $\hat x$ 。

* * *

本页要点总结
------

1.  **Figure 4.7** 把最小二乘几何直观化： $b$  被“拉”到列空间最近点  $p$ ，残差  $e$  退到左零空间。
2.  **正规方程**  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  是最小二乘的核心桥梁。
3.  **残差与投影互为直角**，满足勾股： $\|b\|^{2}=\|p\|^{2}+\|e\|^{2}$ 。
4.  **列独立 ⇒ 唯一最小二乘解**；零空间越小，解越唯一。



![image-20250804044614867](./assets/image-20250804044614867.png)

![](./assets/image-20250804044644019.png)

拟合直线的最小二乘法（Fitting a Straight Line）
===================================

> **概况**：本节把“三点直线拟合”推广到 ** $m>2$ ** 个观测点  $(t_i,b_i)$ 。  
> 我们只有两个未知数  $C,D$ ——直线方程  $b=C+Dt$  的截距与斜率。通常 ** $Ax=b$ ** 无精确解，于是采用最小二乘使误差
> 
> $$
> E=\sum_{i=1}^{m}e_i^{2},\quad e_i=b_i-(C+Dt_i)
> $$
> 
> 达到最小。

* * *

1 矩阵建模与超定方程
-----------

$$
\underbrace{\begin{bmatrix} 1 & t_1\\ 1 & t_2\\ \vdots & \vdots\\ 1 & t_m \end{bmatrix}}_{A\,(m\times2)} \!\! \underbrace{\begin{bmatrix}C\\D\end{bmatrix}}_{x} = \underbrace{\begin{bmatrix}b_1\\b_2\\\vdots\\b_m\end{bmatrix}}_{b}. \tag{5}
$$
*   **列 1** 全 1（常数项），**列 2** 为采样时间  $t_i$ 。
*    $m\!>\!n=2$  ⇒ 高矩阵列空间“很瘦”，绝大多数  $b$  位于其外 → 需最小二乘逼近。

* * *

2 正规方程与点积矩阵
-----------

### 2.1 正规方程

$$
\boxed{A^{\mathsf T}A\hat x=A^{\mathsf T}b}.
$$

### 2.2 点积矩阵  $A^{\mathsf T}A$ 

$$
A^{\mathsf T}A= \begin{bmatrix} m & \sum t_i\\ \sum t_i & \sum t_i^{2} \end{bmatrix}, \qquad A^{\mathsf T}b= \begin{bmatrix} \sum b_i\\ \sum t_i b_i \end{bmatrix}. \tag{6–7}
$$
*   若  $\sum t_i=0$ （时间均值为 0）则第一列与第二列正交， $A^{\mathsf T}A$  变对角，更易求逆。

* * *

3 误差向量与几何意义
-----------

*   **最佳系数**  $\hat x=(C,D)^{\mathsf T}=(A^{\mathsf T}A)^{-1}A^{\mathsf T}b$ 。
*   **预测值**  $p=A\hat x$ ；**残差**  $e=b-p$ 。
*    $e\perp$  列空间 ⇒  $A^{\mathsf T}e=0$ 。
*   **误差平方**
    $$
    E(C,D)=\|Ax-b\|^{2} =(C+Dt_1-b_1)^{2}+\cdots+(C+Dt_m-b_m)^{2}. \tag{8}
    $$
    取偏导  $\partial E/\partial C=\partial E/\partial D=0$  即重获正规方程。

* * *

4 示例 2：列正交带来的简化
---------------

*   观测： $(t,b)=\{(-2,1),(0,2),(2,4)\}$ 。
*   **时间之和**  $t_1+t_2+t_3=0$  ⇒ 列向量  
     $(1,1,1)^{\mathsf T}$  与  $(-2,0,2)^{\mathsf T}$  正交。
*   因此
    $$
    A^{\mathsf T}A=\begin{bmatrix}3&0\\0&8\end{bmatrix},\quad A^{\mathsf T}b=\begin{bmatrix}7\\6\end{bmatrix}. \tag{9}
    $$
    可**分开**求得
    $$
    C=\frac{7}{3},\qquad D=\frac{6}{8}=\frac{3}{4}.
    $$
*   **技巧**：若原时间不满足  $\sum t_i=0$ ，可平移  $T_i=t_i-\bar t$ （ $\bar t$  为平均值）以实现列正交 →  $A_{\text{new}}^{\mathsf T}A_{\text{new}}$  对角，运算更快。

* * *

5 推广提示
------

*   拟合 **多项式**、**指数**、**正弦**等，只需在  $A$  中加入更多列（参数），照样构造  $A^{\mathsf T}A$  与  $A^{\mathsf T}b$ 。
*   列独立 ⇒  $A^{\mathsf T}A$  可逆 ⇒ 最小二乘解唯一。
*   列正交 ⇒  $A^{\mathsf T}A$  对角 ⇒ 计算简化到逐分量除法。

* * *

6 总结
----

1.  **直线最小二乘** = 解 2×2 正规方程。
2.  点积矩阵元素仅依赖 **数据统计量**  $\sum 1,\sum t_i,\sum t_i^{2}$ ，右端仅依赖  $\sum b_i,\sum t_i b_i$ 。
3.  **列正交化（中心化时间）** 可显著简化计算。
4.  几何、代数、微积分三种视角再次统一： $\hat x$  最小化  $\|Ax-b\|^{2}$ ，误差  $e$  与列空间正交。



![image-20250804044653519](./assets/image-20250804044653519.png)

依赖列与伪逆 · 当  $A$  含相关列时的最小二乘解
============================

> **本页主题**：前面一直假设  $A$  列向量线性无关（ $\operatorname{rank}A=n$ ），此时  $A^{\mathsf T}A$  可逆、正规方程唯一。若 **列相关**， $A^{\mathsf T}A$  变奇异，正规方程有无穷多解——我们需要新的“**最佳**”选取准则 → **最小范数解 / 伪逆**。

* * *

1\. 列相关示例与问题提出
--------------

| 矩阵 | 观测向量 | 说明 |
| --- | --- | --- |
|  $A=\begin{bmatrix}1&1\\1&1\end{bmatrix}$  |  $b=\begin{bmatrix}3\\1\end{bmatrix}$  | 两列相同 ⇒ 秩=1 |

*   原方程  $Ax=b$  **无解**（直线无法同时通过  $(T=1,b_1=3)$  与  $(T=1,b_2=1)$ ）。
*   改求 **投影方程**  $A\hat x=p$  ⇒ 无穷多  $\hat x$  满足  $p=(2,2)^{\mathsf T}$ 。其中
    $$
    \hat x=(\hat x_1,\hat x_2),\qquad \hat x_1+\hat x_2=2.
    $$

> 右侧图：所有虚线皆给出同样误差  $e=(1,-1)$ ，但斜线、水平线、垂直线哪条才“最好”？

* * *

2\. 选择“最佳  $\hat x$ ”的策略
------------------------

### 2.1 伪逆最小范数解

*   **Moore–Penrose 伪逆**  $A^{+}$  给予
    $$
    \boxed{\hat x^{+}=A^{+}b}
    $$
    其中  $\hat x^{+}$  在列空间部分最优，且 **长度最短**。
*   例中
    $$
    \hat x^{+}=(1,1)^{\mathsf T},\quad\|\hat x^{+}\|=\sqrt2
    $$
    （其他可行解如  $(2,0),(0,2)$  长度=2，更长）。

### 2.2 零空间分量置零

*   所有解可写  $\hat x=\hat x^{+}+z,\;z\in N(A)$ 。
*   **最短** ⇔ **抛弃零空间成分**（把  $z$  设 0）。

### 2.3 代数性质

*   若列独立，则伪逆退化为左逆  $(A^{\mathsf T}A)^{-1}A^{\mathsf T}$ 。
*   当列相关，伪逆仍定义良好，给出唯一最小范数解，数值软件（MATLAB、NumPy）均依赖 SVD 计算。

* * *

3\. 伪逆解决“奇异、近奇异、无解”三大难点
-----------------------

1.  **奇异矩阵**： $A^{\mathsf T}A$  不可逆 → 伪逆照算。
2.  **多解**：伪逆挑出长度最短者。
3.  **接近奇异**：伪逆或正则化（Tikhonov）可避免数值爆炸、NaN、Inf。

* * *

4\. 与下一章 Gram–Schmidt 的关联
-------------------------

*   本页小节首句：“这正是下节 _Gram–Schmidt_ 的思想——**预先让列正交**”。
*   若用 Gram–Schmidt 将列正交化，则
    $$
    A_{\text{new}}^{\mathsf T}A_{\text{new}}=\text{对角/恒等},
    $$
    正规方程简化，亦避免列相关问题。

* * *

5\. 结论提要
--------

1.  **列相关 ⇒  $A^{\mathsf T}A$  奇异 ⇒ 解无限多**。
2.  **伪逆**  $A^{+}$  提供 **唯一最小范数解**：舍弃零空间分量。
3.  这一解同时满足最小二乘误差与最小  $\|\hat x\|$ 。
4.  **数值实践**：SVD、QR 带列选、自适应正交化是应对相关/近相关的主要工具。

。

## ![image-20250804044700808](./assets/image-20250804044700808.png)
用二次曲线作最小二乘拟合（Fitting by a Parabola）
===================================

> **本节目标**：将“直线最小二乘”扩展到 **抛物线**
> 
> $$
> b(t)\;=\;C + Dt + Et^{2},
> $$
> 
> 并给出一般  $m$  点与 **3 × 3 正规方程** 的解析形式与数值示例。

* * *

1 问题建模
------

### 1.1 矩阵形式

$$
\underbrace{\begin{bmatrix} 1 & t_1 & t_1^{2}\\ 1 & t_2 & t_2^{2}\\ \vdots & \vdots & \vdots\\ 1 & t_m & t_m^{2} \end{bmatrix}}_{A\;(m\times3)} \! \underbrace{\begin{bmatrix}C\\D\\E\end{bmatrix}}_{x} =\; \underbrace{\begin{bmatrix}b_1\\b_2\\\vdots\\b_m\end{bmatrix}}_{b}. \tag{10}
$$
*   列 1：常数项     
*   列 2：一次项  $t_i$   
*   列 3：二次项  $t_i^{2}$ 

> 当  $m>3$ （实际常见）时，方程一般 **无精确解**，需最小二乘逼近。

### 1.2 正规方程

$$
\boxed{A^{\mathsf T}A\hat x=A^{\mathsf T}b}\quad (\hat x=(C,D,E)^{\mathsf T}). 
$$
*   ** $A^{\mathsf T}A$ ** 为  $3\times3$  对称矩阵
    $$
    A^{\mathsf T}A= \begin{bmatrix} m & \sum t_i & \sum t_i^{2}\\ \sum t_i & \sum t_i^{2} & \sum t_i^{3}\\ \sum t_i^{2} & \sum t_i^{3} & \sum t_i^{4} \end{bmatrix}. \tag{6}
    $$
*   **右端**
    $$
    A^{\mathsf T}b= \begin{bmatrix} \sum b_i\\ \sum t_i b_i\\ \sum t_i^{2} b_i \end{bmatrix}. \tag{7\&8}
    $$

> **投影视角**：列空间现为 3 维曲面；最优预测  $p=A\hat x$  为“最近抛物线”上高度。

* * *

2 几何 & 微积分再统一
-------------

| 角度 | 关键条件 |
| --- | --- |
| **几何** | 误差  $e=b-A\hat x$  与列空间垂直： $A^{\mathsf T}e=0$ 。 |
| **代数** | 同上 ⇒ 正规方程。 |
| **微积分** | 最小化  $\displaystyle E(C,D,E)=\sum_{i}(C+Dt_i+Et_i^{2}-b_i)^{2}$ 。  
偏导  $\partial E/\partial C,\partial E/\partial D,\partial E/\partial E$  皆为零 ⇔ 正规方程。 |

* * *

3 Example 3：三点**精确**通过抛物线
-------------------------

> 点集： $(t,b)=\{(0,6),(1,0),(2,0)\}$ 

### 3.1 方程组

$$
\begin{cases} C + D\cdot0 + E\cdot0^{2} = 6,\\ C + D\cdot1 + E\cdot1^{2} = 0,\\ C + D\cdot2 + E\cdot2^{2} = 0. \tag{11} \end{cases}
$$

对应方阵

$$
A=\begin{bmatrix}1&0&0\\1&1&1\\1&2&4\end{bmatrix}, \quad b=\begin{bmatrix}6\\0\\0\end{bmatrix}.
$$

### 3.2 解得

$$
(C,\;D,\;E)=(6,\,-9,\;3).
$$
*   **得到抛物线**
    $$
    b=6-9t+3t^{2}.
    $$
*   由于  $m=n=3$  且  $A$  可逆，本例 **无最小二乘残差**；抛物线精确穿过 3 点。

* * *

4 通用最小二乘流程（抛物线版）
----------------

1.  **统计量预处理**：计算  $\sum t_i^{k}$  和  $\sum t_i^{k}b_i$ （ $k=0,1,2,3,4$ ）。
2.  **组装正规方程**  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$ 。
3.  **求逆/分解** 解  $3\times3$  系统（可用 Cholesky、QR、SVD）。
4.  **预测值**  $p=A\hat x$ ，**误差**  $e=b-p$ 。
5.  若  $\sum t_i=0$  或经中心化，列 2 与列 1 正交，可使  $A^{\mathsf T}A$  下三角清零并加速求解（与直线拟合相同思路）。

* * *

5 连接更高阶与无限阶（Fourier 系列）
-----------------------

*   任何 **多项式拟合**：增加列  $t^{3}, t^{4},\dots$  即可。
*   **Fourier/正弦余弦基**：列空间扩展到无限维，最小二乘成为 **Fourier 系列** 系数计算——同一线性代数框架在希尔伯特空间继续成立。

* * *

6 小结
----

1.  抛物线最小二乘利用 ** $3\times3$  正规方程**，与直线拟合仅多出平方列。
2.  几何、代数、微积分三路依旧统一。
3.  当数据点刚好等于参数个数且矩阵可逆 ⇒ 可 **精确插值**；否则最小二乘逼近。
4.  列正交化（中心化时间、Gram–Schmidt）能显著简化正规方程。
5.  同样思路可推广至任何基函数集合，包括高阶多项式、傅里叶基、样条等。



![image-20250804044707987](./assets/image-20250804044707987.png)

![image-20250804044713367](./assets/image-20250804044713367.png)



【4.3 Worked Examples】含异常值的最小二乘实例
--------------------------------

对“水平线/直线/抛物线”三类实例，展示 **不同误差准则**、**列尺度变换** 与 **列正交 (对称时间取样)** 的影响。

* * *

### 一、实例 4.3 A：10 个点中有一个离群值

| 条件 | 数据设置 |
| --- | --- |
| 时间  $t=1,\dots ,9$   |  $b_1,\dots ,b_9=0$  |
| 时间  $t=10$   |  $b_{10}=40$ （离群） |

> 目标：用水平线  $y=C$  拟合这 10 点，比较三种误差准则：

| 准则 | 定义 | 最优  $C$  |
| --- | --- | --- |
| **(1) 最小二乘**  $E_2$  |  $\sum_{i=1}^{10}e_i^2$  |  $C=4$ （正规方程  $10C=40$ ） |
| **(2) 最小最大误差**  $E_\infty$  | (\\max | e\_i |
| **(3) 最小绝对和**  $E_1$  | (\\sum | e\_i |

_统计学视角_：最小二乘对离群点最敏感， $E_1$  最鲁棒。

* * *

#### 继续：用直线  $y=C+Dt$  拟合同 10 点

*   **统计量**
    $$
    A^{\mathsf T}A=\!\begin{bmatrix}10&55\\55&385\end{bmatrix}, \; A^{\mathsf T}b=\!\begin{bmatrix}40\\400\end{bmatrix}.
    $$
*   **正规方程** 解得
    $$
    C=-8,\quad D=\frac{24}{11}\approx2.18.
    $$
*   **缩放与平移性质**
    *   若将  $b$  乘 3 ⇒  $C,D$  亦乘 3。
    *   若给所有  $b_i$  加同一常数 30 ⇒ 仅  $C$  增 30。

* * *

### 二、实例 4.3 B：用抛物线拟合对称采样

| 采样 |  $t=-2,-1,0,1,2$ ， $b=0,0,1,0,0$  |  
| 方程 |  $A=\begin{bmatrix}1&-2&4\\1&-1&1\\1&0&0\\1&1&1\\1&2&4\end{bmatrix}$  |

1.  **列 2 与列 1、3 正交**（因时间关于 0 对称）  
     $\Rightarrow A^{\mathsf T}A$  对角化 → 正规方程分离
    $$
    \begin{bmatrix}5&0&10\\0&10&0\\10&0&34\end{bmatrix} \begin{bmatrix}C\\D\\E\end{bmatrix}=\begin{bmatrix}1\\0\\0\end{bmatrix}.
    $$
2.  **求解**
    $$
    C=\frac{34}{70},\; D=0\ \text{(对称导致)},\; E=-\frac{10}{70}.
    $$
    抛物线关于  $t=0$  对称，斜率  $D$  必为 0。

* * *

### 三、依赖列时的伪逆（延续上页）

当列相关时正规方程奇异，需采用 **Moore–Penrose 伪逆** 给出唯一最小范数解  $\hat x^{+}$ ，等同于把零空间分量设 0。

* * *

### 四、关键思想回顾（教材小结扩展）

1.  **最小二乘目标**
    $$
    \hat x=\arg\min\|Ax-b\|^{2} =\arg\min\bigl(x^{\mathsf T}A^{\mathsf T}Ax-2x^{\mathsf T}A^{\mathsf T}b\bigr).
    $$
2.  **正规方程**
    $$
    A^{\mathsf T}A\hat x=A^{\mathsf T}b,\qquad e=b-A\hat x,\quad A^{\mathsf T}e=0.
    $$
3.  **直线拟合**：两参数  $C,D$ ，点积矩阵为  $2\times2$ 。
4.  **残差几何**： $p=A\hat x$  在列空间；纵向误差向量  $e$  在左零空间； $\|e\|$  最小。
5.  **基函数泛化**：列数  $n$  可为任意基函数数目； $m>n$  时用最小二乘， $m=n$  时若 $A$  可逆则可精确插值。

* * *

### 五、小结

*   离群值会极大影响  $E_2$  方案； $E_\infty$  与  $E_1$  通常更鲁棒。
*   在直线拟合中，对称化  $t$  可使列正交 ⇒ 正规方程对角化简。
*   抛物线拟合同理：若采样对称，斜率项  $D$  自然为 0。
*   列相关  $\Rightarrow$  需伪逆；列独立但近相关  $\Rightarrow$  建议 QR/SVD 或正则化。



![image-20250804044718845](./assets/image-20250804044718845.png)

!![image-20250804044732817](./assets/image-20250804044732817.png)

![image-20250804044737490](./assets/image-20250804044737490.png)



第 4.4 节 · 正交归一基与 Gram–Schmidt 过程
================================

> 本节有两重目标：
> 
> 1.  说明为什么**正交列向量**（尤其是单位向量）能极大简化最小二乘与数值计算；
> 2.  介绍 **Gram–Schmidt** 算法——把任意线性无关列  $a_1,\dots,a_n$  转化为正交归一列  $q_1,\dots,q_n$ ，并得到 **QR 分解**  $A=QR$ 。
>     

* * *

1 正交归一列矩阵  $Q$  的性质
-------------------

| # | 课件条目 | 解读 |
| --- | --- | --- |
| **1** | 若列向量  $q_i$  满足  $q_i^{\mathsf T}q_j=\delta_{ij}$ （克罗内克 δ），则  $Q^{\mathsf T}Q=I$ 。 | 列两两垂直且单位，称 **orthonormal 基**。 |
| **2** | 若  $Q$  亦是方阵，则  $QQ^{\mathsf T}=I$  且  $Q^{\mathsf T}=Q^{-1}$ 。 | **正交矩阵**：转置即逆，保持向量长度与夹角。 |
| **3** | 对正交列矩阵  $Q$ ，最小二乘方程  $Qx=b$  的解直接为  $\hat x=Q^{\mathsf T}b$ ，投影为  $p=QQ^{\mathsf T}b=Pb$ 。 | 省去了求逆。(因为  $Q^{\mathsf T}Q=I$ ) |
| **4–6** | Gram-Schmidt：  
•  $q_1=a_1/\lVert a_1\rVert$   
• 对  $i>1$  去掉  $a_i$  在先前  $q$  上的投影后归一化  
• 最终  $A=QR$ ， $R$  上三角。 | 逐列正交化； $R_{ij}=q_i^{\mathsf T}a_j$ （ $i\le j$ ）。 |

> **要点**：有了正交列， $A^{\mathsf T}A$  变对角或恒等，正规方程与最小二乘求解极简。

* * *

2 例举的正交矩阵类型
-----------

| 类型 | 典型形式  $Q$  | 特征 |
| --- | --- | --- |
| **旋转 (Rotation)** |  $\begin{bmatrix}\cos\theta&-\sin\theta\\\sin\theta&\cos\theta\end{bmatrix}$  |  $Q^{\mathsf T}=Q^{-1}$ ；保长度、旋转平面角度  $\theta$ 。 |
| **置换 (Permutation)** | 交换坐标轴，如  $\begin{bmatrix}0&1\\1&0\end{bmatrix}$  | 行列互换； $Q^{\mathsf T}=Q^{-1}$ ；所有置换矩阵皆正交。 |
| **反射 (Reflection)** |  $Q=I-2uu^{\mathsf T}$ （ $u$  为单位向量） | 关于  $u$  的垂直超平面镜像；对称且正交。 |

> 共同点：** $Q^{\mathsf T}Q=I$ **，因此都保持向量范数与点积不变。

* * *

3 Gram–Schmidt 过程细节
-------------------

1.  **首向量归一化**
    $$
    q_1=\frac{a_1}{\lVert a_1\rVert}.
    $$
2.  **迭代步骤（ $i=2\dots n$ ）**
    *   去除投影：
        $$
         p_i=\sum_{k=1}^{i-1}(a_i^{\mathsf T}q_k)q_k, \quad \tilde a_i=a_i-p_i.
        $$
    *   归一化： $q_i=\tilde a_i/\lVert\tilde a_i\rVert$ 。
3.  **构造  $R$ **：
    $$
    R_{ij}=q_i^{\mathsf T}a_j,\; i\le j,\qquad R_{ij}=0,\; i>j.
    $$
4.  **得到 QR**： $A=QR$ ，其中  $Q^{\mathsf T}Q=I$ 、 $R$  上三角。

> **数值意义**：QR 比  $A^{\mathsf T}A$  更稳定；求最小二乘可改写为
> 
> $$
> Rx=Q^{\mathsf T}b\quad(\text{回代即可}).
> $$

* * *

4 正交列的优势总结
----------

1.  **正规方程简化**： $Q^{\mathsf T}Q=I$  ⇒ 直接  $\hat x=Q^{\mathsf T}b$ 。
2.  **数值稳定**：避免  $(A^{\mathsf T}A)$  的病态放大误差。
3.  **易逆/易转置**：正交方阵转置即逆。
4.  **保持几何量**：长度与角度不变，用于旋转、反射、坐标变换。

* * *

5 本节小结
------

*   **正交归一基**：点积零 + 长度一；矩阵表示即  $Q^{\mathsf T}Q=I$ 。
*   **Gram–Schmidt**：把一般基向量系统化为正交归一列，并产出 **QR 分解**。
*   **正交矩阵**（旋转、置换、反射等）广泛应用于图形学、信号处理、数值算法。
*   在最小二乘与投影问题中，拥有正交列意味着**算法一步到位**且**数值稳定**。



![image-20250804044749622](./assets/image-20250804044749622.png)



正交归一基投影公式：用  $QQ^{\mathsf T}$  取代  $A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$ 
=========================================================================

——4.4 节「Projections  $QQ^{\mathsf T}$  Using Orthonormal Bases」笔记

* * *

1\. 主题概览
--------

*   **核心思想**：若把基向量  $a_1,\dots ,a_n$  事先正交归一化为  $q_1,\dots ,q_n$ （列矩阵  $Q$ ），则所有涉及  $A^{\mathsf T}A$  的公式通通化为 ** $Q^{\mathsf T}Q=I$ ** ——再无矩阵求逆。
*   **结果**：
    *   最小二乘解  $\hat x = Q^{\mathsf T}b$ 。
    *   投影向量  $p = Q\hat x = QQ^{\mathsf T}b$ 。
    *   投影矩阵  $P = QQ^{\mathsf T}$ （对称、幂等）。
    *    $Q$  方阵时  $P=I$ ；一维投影累加即可重构  $b$ 。

* * *

2\. 公式精释
--------

### 2.1 正交列矩阵的最小二乘与投影 (公式 (4))

$$
\boxed{\hat x = Q^{\mathsf T}b},\qquad \boxed{p = Q\hat x = QQ^{\mathsf T}b},\qquad \boxed{P = QQ^{\mathsf T}}.
$$
*   **无逆**： $Q^{\mathsf T}Q=I$  直接消去正规方程中的  $A^{\mathsf T}A$ 。
*   **一维投影**： $(q_i^{\mathsf T}b)q_i$ ——把  $b$  拆为  $n$  条正交分量后再相加。

### 2.2 向量分解 (公式 (5)–(6))

$$
p=Q\underbrace{\begin{bmatrix}q_1^{\mathsf T}b\\\vdots\\q_n^{\mathsf T}b\end{bmatrix}}_{\text{坐标}}, \qquad b = \sum_{i=1}^{n}q_i(q_i^{\mathsf T}b).
$$
*   对 **完备正交基**（ $m=n$  方阵），上式即 **傅里叶展开**； $QQ^{\mathsf T}=I$  将  $b$  完整拼回。

* * *

3\. 例 4：三维正交矩阵投影演示
------------------

> **给定**
> 
> $$
> Q=\tfrac13 \begin{bmatrix} -1 & 2 & 2\\ 2 & -1 & 2\\ 2 & 2 & -1 \end{bmatrix},\qquad Q^{\mathsf T}Q=I.
> $$
> 
> 取  $b=(0,0,1)^{\mathsf T}$ 。

1.  **各列投影**
    $$
    p_1=q_1(q_1^{\mathsf T}b)=\tfrac23q_1,\quad p_2=q_2(q_2^{\mathsf T}b)=\tfrac23q_2,\quad p_3=q_3(q_3^{\mathsf T}b)=-\tfrac13q_3.
    $$
2.  **组合**
    *   前两项  $p_1+p_2$ ： $b$  在  $q_1,q_2$  所张平面上的投影。
    *   三项相加  $p_1+p_2+p_3=b$  ——验证  $QQ^{\mathsf T}=I$  对完备基的“保真”性质。

* * *

4\. 深入理解与拓展
-----------

1.  **正交列的数值优势**
    *   稳定：范数不爆炸，易保持数值精度。
    *   省时：正规方程免逆运算；QR 回代比  $(A^{\mathsf T}A)^{-1}$  更快。
2.  **从一维到无限维**
    *   正交展开思想延伸到傅里叶/离散余弦/小波等**正交变换**——先投影再逆变换。
3.  **与 Gram–Schmidt 对接**
    *   QR 提供正交  $Q$ ，此节展示用 ** $Q$  替代  $A$ ** 在投影/最小二乘中的好处。

* * *

5\. 总结要点快速回顾
------------

| 关键语句 | 含义 |
| --- | --- |
|  $Q^{\mathsf T}Q=I$  | 列向量正交归一。 |
| 最小二乘： $\hat x=Q^{\mathsf T}b$  | 无需求逆，直接点积坐标。 |
| 投影： $p=QQ^{\mathsf T}b$  | “先坐标后还原”两步合一。 |
| 完备基： $QQ^{\mathsf T}=I$  | 投影矩阵成单位， $b$  被完美重构。 |
| 正交变换 | 旋转、置换、反射等皆满足  $Q^{\mathsf T}=Q^{-1}$ 。 |



![image-20250804044755487](./assets/image-20250804044755487.png)

![image-20250804044800317](./assets/image-20250804044800317.png)



Gram-Schmidt 正交化过程与 QR 分解
=========================

> **涵盖内容**：正交列带来的计算优势、Gram-Schmidt 逐步构造正交向量的公式 (7)(8)，示意图 4.10 与数值示例  $a,b,c$  生成  $q_1,q_2,q_3$ 。

* * *

1 背景回顾与目标
---------

*   **正交列好处**：
    1.   $Q^{\mathsf T}Q=I$ ，正规方程免逆： $\hat x=Q^{\mathsf T}b$ ， $p=QQ^{\mathsf T}b$ 。
    2.  投影矩阵  $P=QQ^{\mathsf T}$  只需一乘一转置。
    3.  长度不放大，数值更稳定。
*   **目标**：给定独立列  $a_1,a_2,a_3$ （记作  $a,b,c$ ），用 **Gram-Schmidt** 生成正交归一列  $q_1,q_2,q_3$ ，并得到
    $$
    A=[a_1\,a_2\,a_3]=QR,\quad Q=[q_1\,q_2\,q_3],\; R\text{ 上三角}.
    $$

* * *

2 Gram-Schmidt 公式与步骤
--------------------

| 步骤 | 说明 | 公式 |
| --- | --- | --- |
| ① 初始方向 | 取  $A=a$ 。 |  $q_1=\dfrac{a}{\lVert a\rVert}$  |
| ② 使  $b$  垂直于  $a$  | 减去在  $a$  上的投影 |  $B=b-\dfrac{a^{\mathsf T}b}{a^{\mathsf T}a}\,a$  (7) |
| ③ 归一化 ② 得  $q_2$  |  $q_2=B/\lVert B\rVert$  | — |
| ④ 使  $c$  同时垂直于  $a,B$  | 依次减去两投影 |  $C=c-\dfrac{a^{\mathsf T}c}{a^{\mathsf T}a}\,a-\dfrac{B^{\mathsf T}c}{B^{\mathsf T}B}\,B$  (8) |
| ⑤ 归一化 ④ 得  $q_3$  |  $q_3=C/\lVert C\rVert$  | — |

> **要点**：每次“**减投影**”→ 得到剩余垂直分量，再归一化。若还有第 4 列  $d$ ，重复减三次投影即可。

* * *

3 图 4.10 直观示意
-------------

*   **左图**：先把  $b$  投到  $a$  的方向得  $p$ ，再取残差  $B=b-p$ 。
*   **中图**：再把  $c$  在  $a,B$  张成的平面上投影得到  $p$ ，残差  $C$  即垂直于二者。
*   **右图**：归一化后得到单位向量  $q_1,q_2,q_3$ 。

* * *

4 数值示例：
-------

$$
a=\begin{bmatrix}1\\-1\\0\end{bmatrix},\; b=\begin{bmatrix}2\\0\\-2\end{bmatrix},\; c=\begin{bmatrix}3\\-3\\3\end{bmatrix}.
$$

| 步骤 | 计算 | 结果 |
| --- | --- | --- |
|  $a^{\mathsf T}a=2,\; a^{\mathsf T}b=2$  |  $B=b-\frac{2}{2}a$  |  $B=\begin{bmatrix}1\\1\\-2\end{bmatrix}$  |
| 检验  $a^{\mathsf T}B=0$  | — | 成功垂直 |
|  $a^{\mathsf T}c=6,\;B^{\mathsf T}c=6$  |  $C=c-\frac{6}{2}a-\frac{6}{6}B$  |  $C=\begin{bmatrix}1\\1\\1\end{bmatrix}$  |
| 长度 |  $\lVert a\rVert=\sqrt2,\;\lVert B\rVert=\sqrt6,\;\lVert C\rVert=\sqrt3$  | — |
| 单位化 |  $q_1=\frac1{\sqrt2}[1,-1,0]^{\mathsf T}$  |  $q_2=\frac1{\sqrt6}[1,1,-2]^{\mathsf T}$  |

*   **验证**： $q_i^{\mathsf T}q_j=\delta_{ij}$ ， $Q^{\mathsf T}Q=I$ 。
*   **QR 分解**： $A=[a\,b\,c]=Q\,R$ ，其中
    $$
    R=\begin{bmatrix} \lVert a\rVert & a^{\mathsf T}b/\lVert a\rVert & a^{\mathsf T}c/\lVert a\rVert\\ 0 & \lVert B\rVert & B^{\mathsf T}c/\lVert B\rVert\\ 0 & 0 & \lVert C\rVert \end{bmatrix}.
    $$

* * *

5 总结
----

1.  **Gram-Schmidt 核心**：每新向量减掉已确定正交方向的投影。
2.  **结果**：得到正交归一列  $Q$  与上三角  $R$ ，满足  $A=QR$ 。
3.  **应用**：
    *   QR 求最小二乘：解  $Rx=Q^{\mathsf T}b$ 。
    *   正交列带来数值稳定与简化（无逆、直接点积）。
4.  **对称采样**：若输入列天然正交（如时间中心化），Gram-Schmidt 仅需归一化，计算量更小。



![image-20250804044807651](./assets/image-20250804044807651.png)

![image-20250804044812108](./assets/image-20250804044812108.png)



**QR 分解的本质与 Gram-Schmidt 的数值实现**
================================

（对应课件页：“The Factorization  $A = QR$ ” 与算法框图）

* * *

一、概念总览
------

当我们对矩阵  $A$  进行 Gram-Schmidt 正交化时，就把它分解成

$$
A = QR,
$$

其中

| 组成 | 含义 | 关键性质 |
| --- | --- | --- |
|  $Q=[q_1\,q_2\,q_3]$  | **正交归一列矩阵**（  $\,q_i^{\mathsf T}q_j=\delta_{ij}$ ） |  $Q^{\mathsf T}Q=I$ ，若  $m=n$  还满足  $QQ^{\mathsf T}=I$  |
|  $R$  | **上三角矩阵**，对角线为  $\lVert A,B,C\rVert$  |  $R_{ij}=q_i^{\mathsf T}a_j,\ i\le j$ ；后列与前列正交 ⇒ 上三角 |

> _图示解读_：
> 
> *   第一步： $q_1$  由  $a$  归一化；后向量未参与。
> *   第二步：用  $a,b$  张成的平面确定  $q_2$ ，仍未牵涉  $c,q_3$ 。
> *   第三步： $q_3$  才开始出现。**“后向量不影响已定向量”** 使  $R$  呈上三角。
>     

* * *

二、从 Gram-Schmidt 推导 QR
----------------------

1.  **向量关系**
    $$
    \begin{bmatrix}a & b & c\end{bmatrix} = \begin{bmatrix}q_1 & q_2 & q_3\end{bmatrix} \! \begin{bmatrix} q_1^{\mathsf T}a & q_1^{\mathsf T}b & q_1^{\mathsf T}c\\ 0 & q_2^{\mathsf T}b & q_2^{\mathsf T}c\\ 0 & 0 & q_3^{\mathsf T}c \end{bmatrix} =QR. \tag{9}
    $$
2.  **验证**：左右两边同乘  $Q^{\mathsf T}$  得  $R=Q^{\mathsf T}A$ ，明确了上三角结构。
3.  **示例数值**
    *   已得
        $$
        A=\begin{bmatrix}1&2&3\\-1&0&-3\\0&-2&3\end{bmatrix},\quad Q=\Bigl[\frac1{\sqrt2}[1,-1,0],\; \frac1{\sqrt6}[1,1,-2],\; \frac1{\sqrt3}[1,1,1]\Bigr], 
        $$
        $$
        R=\begin{bmatrix} \sqrt2 & \sqrt2 & \sqrt{18}\\ 0 & \sqrt6 & -\sqrt6\\ 0 & 0 & \sqrt3 \end{bmatrix},
        $$
        并验证  $A=QR$ 。

* * *

三、最小二乘的 QR 途径
-------------

> 传统正规方程： $A^{\mathsf T}A\hat x=A^{\mathsf T}b$   
> **QR 方式**：
> 
> $$
> A\hat x=b\;\Longrightarrow\;QR\hat x=b \;\Longrightarrow\; R\hat x = Q^{\mathsf T}b\quad (\text{10})
> $$
> *    $R$  上三角 → **回代**即可，避免求逆；
> *   数值稳定性高（不涉及  $A^{\mathsf T}A$  的平方条件数）。
>     

* * *

四、原 & 改进 Gram-Schmidt 的算法细节
---------------------------

### 4.1 “一次减所有”公式（原版）

$$
C = c-\frac{a^{\mathsf T}c}{a^{\mathsf T}a}a-\frac{B^{\mathsf T}c}{B^{\mathsf T}B}B. \tag{8}
$$

### 4.2 **Modified Gram-Schmidt (MGS)** — 逐次减投影（框内伪码）

```matlab
for j = 1:n        % 处理第 j 列
  v = A(:,j);
  for i = 1:j-1    % 已完成的 q1…q_{j-1}
      R(i,j) = Q(:,i)' * v;
      v = v - R(i,j) * Q(:,i);
  end
  R(j,j) = norm(v); 
  Q(:,j) = v / R(j,j);   % 获得 qj
end
```

*   **稳定性提升**：每步只减一次投影，避免因舍入误差积累而丢失正交性。

### 4.3 结束回代公式 (12)

$$
\text{(列 }j\text{ 的 }A)=\sum_{i=1}^{j}R(i,j)q_i.
$$

* * *

五、关键洞察与比较
---------

| 主题 | LU 分解 | QR 分解 |
| --- | --- | --- |
| 结构 | 下三角+上三角 | 正交+上三角 |
| 应用 | 直接求解  $Ax=b$  | 最小二乘、特征值、迭代法 |
| 稳定性 | 与  $A$  条件数相近 | **不增大条件数**，保长度 |

> **Trick**： $A^{\mathsf T}A=(QR)^{\mathsf T}(QR)=R^{\mathsf T}R$ ，正规方程等价于  $R^{\mathsf T}R\hat x = R^{\mathsf T}Q^{\mathsf T}b$ ；回代两次即可。

* * *

六、本页小结
------

1.  **Gram-Schmidt 精髓**：逐列减投影 → 得到  $Q$  正交列与  $R$  上三角。
2.  **QR 优势**：
    *   求最小二乘只用回代；
    *   数值稳定性优于正规方程；
    *   先正交、后简化。
3.  **Modified 版本** 更抗舍入误差；工业实现（MATLAB、NumPy）多采用 MGS、Householder、Givens 等更稳定方案。
4.  **思维迁移**：QR 与傅里叶、SVD、PCA 等“正交展开”本质同源——**先投影，再重构**。



![image-20250804044825422](./assets/image-20250804044825422.png)

![image-20250804044831492](./assets/image-20250804044831492.png)

4.4 正交矩阵的总结与 Hadamard 矩阵示例
==========================

（对应图片：Review of the Key Ideas，Worked Examples 4.4A/B，以及总结表）

* * *

一、核心概念回顾
--------

| 关键结论 | 含义与应用 |
| --- | --- |
| **1 正交归一列**  $Q^{\mathsf T}Q=I$  | 列向量两两正交且单位，所有公式大幅简化。 |
| **2 方阵  $Q$  为正交矩阵** |  $Q^{\mathsf T}=Q^{-1}$ ：转置即逆。 |
| **3 长度保持** |  $\|Qx\|=\|x\|$ ，旋转/反射/置换均属此类。 |
| **4 列空间投影** |  $P=QQ^{\mathsf T}$ ，投影向量  $p=QQ^{\mathsf T}b$ 。 |
| **5 完备基投影** | 若  $Q$  方阵，则  $P=I$ ； $b$  可按  $\sum q_i(q_i^{\mathsf T}b)$  分解。 |
| **6 Gram–Schmidt → QR** | 独立列  $a_j$  经正交化得  $q_j$ ，并生成上三角  $R$ ，满足  $A=QR$ 。 |

* * *

二、Worked Example 4.4 A：Hadamard 矩阵正交化
-------------------------------------

### 2.1 Hadamard 基础

$$
H_2=\begin{bmatrix}1&1\\1&-1\end{bmatrix},\qquad H_4=\begin{bmatrix} H_2 & H_2\\ H_2 & -H_2 \end{bmatrix} = \begin{bmatrix} 1&1&1&1\\ 1&-1&1&-1\\ 1&1&-1&-1\\ 1&-1&-1&1 \end{bmatrix}.
$$
*   每列仅含  $\pm1$ ，列向量互相正交。
*   将  $H_4$  除以 2 得到 ** $Q_4=H_4/2$ **，列向量单位化（长度 =2）。
*   **5×5 Hadamard 不存在**：5 列中若每列皆含 5 个  $\pm1$ ，两列点积无法为 0。

### 2.2 投影示例

*   给  $b=(6,0,0,2)^{\mathsf T}$ 。
*   投影到第一列： $p_1=(2,2,2,2)^{\mathsf T}$ 。
*   投影到第二列： $p_2=(1,-1,1,-1)^{\mathsf T}$ 。
*   问： $p_{1,2}=p_1+p_2$  为？
    $$
    (2,2,2,2)+(1,-1,1,-1)=(3,1,3,1).
    $$

* * *

三、Worked Example 4.4 B：正交列的意义
-----------------------------

**问题**：正交列最大的好处？

> **答案**： $Q^{\mathsf T}Q$  为 **对角（或恒等）** → 逆矩阵和投影都只需逐分量处理，无耦合。

* * *

四、扩展：构造更高阶 Hadamard
-------------------

*   通过递归块
    $$
    H_{2k}=\begin{bmatrix}H_k&H_k\\H_k&-H_k\end{bmatrix},
    $$
    生成  $H_8，H_{16},\dots$ 。
*    $H_8$  的列长度为  $\sqrt8$ ，正交性有
    $$
    H_8^{\mathsf T}H_8 = \begin{bmatrix} 8I & 0\\ 0 & 8I \end{bmatrix}.
    $$
    单位化得  $Q_8=H_8/\sqrt8$ 。

* * *

五、总表对比：一般矩阵  $A$  vs 正交矩阵  $Q$ 
-------------------------------

| 主题 | 一般  $A$  | 正交  $Q$  |
| --- | --- | --- |
| Gram–Schmidt |  $A=QR$  | 已满足  $Q^{\mathsf T}Q=I$  |
| 投影矩阵  $P$  |  $P=A(A^{\mathsf T}A)^{-1}A^{\mathsf T}$  |  $P=QQ^{\mathsf T}$  |
| 最小二乘解 |  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$  |  $\hat x=Q^{\mathsf T}b$  |
| 伪逆  $A^{+}$  |  $R^{+}Q^{\mathsf T}=R^{-1}Q^{\mathsf T}$  |  $Q^{+}=Q^{\mathsf T}$  |

* * *

六、软件实现与数值稳定性
------------

*   **实际代码（MATLAB qr、NumPy linalg.qr）** 多采用 **Householder 反射** 或 **Givens 旋转** → 比 Gram–Schmidt 稳定。
*   若  $A$  本身是三对角或稀疏结构，可用 **2×2 Givens 旋转** 进一步加速，仍可写成  $A=QR$ 。
*   **Modified Gram–Schmidt (MGS)**：逐列投影，避免舍入误差累积（伪码已示）。

* * *

七、小结
----

1.  **正交列 → 一切简化**：投影、最小二乘、伪逆都只需点积与回代。
2.  **Hadamard  $H_{2^k}$ ** 提供了易于实现的 ±1 正交列示例，可直接单位化成  $Q$ 。
3.  **软件层面**：工业级 LAPACK / BLAS 使用 Householder 或 Givens，比普通 Gram–Schmidt 更可靠；但理解 Gram–Schmidt 仍是掌握 QR 核心逻辑的关键。



## ![image-20250804044838810](./assets/image-20250804044838810.png)
**矩阵的伪逆  $A^{+}$ ——4.5 小节完整笔记**
===============================

概况：本节说明在列不独立或方程  $Ax=b$  无/多解时，如何用 **伪逆**  $A^{+}$  统一获得

*   **最小二乘解**（误差  $\|Ax-b\|$  最小），以及
*   **最小范数解**（在所有最小误差解中  $\|x\|$  最短）。

* * *

1 一侧逆（left/right inverse）与真逆的比较
-------------------------------

| 场景 | 排列 | 条件 | 逆的形式 |
| --- | --- | --- | --- |
| **真逆** |  $r=m=n$  | 方阵满秩 |  $A^{-1}$  使  $AA^{-1}=A^{-1}A=I$  |
| **左逆** |  $r=n<m$ （列独立，行欠缺） |  $A^{\mathsf T}A$  可逆 |  $A^{+}= (A^{\mathsf T}A)^{-1}A^{\mathsf T}$ ，有  $A^{+}A=I$  |
| **右逆** |  $r=m<n$ （行独立，列多余） |  $AA^{\mathsf T}$  可逆 |  $A^{+}=A^{\mathsf T}(AA^{\mathsf T})^{-1}$ ，有  $AA^{+}=I$  |
| **一般伪逆** |  $r<\min(m,n)$  | 皆不满足真/单侧逆 | 下节用 SVD 构造；满足四条 Moore–Penrose 条件 |

> **零空间角度**
> 
> *   列独立  $\Rightarrow N(A)=\{0\}$ ，左逆存在。
> *   行独立  $\Rightarrow N(A^{\mathsf T})=\{0\}$ ，右逆存在。
>     

* * *

2 伪逆在最小二乘中的角色
-------------

### 2.1 当  $r=n<m$ （Tall matrix, 列独立）

*   方程  $Ax=b$  一般 **无解**。
*   伪逆给出 ** $\hat x=A^{+}b$ **，满足正规方程  $A^{\mathsf T}A\hat x=A^{\mathsf T}b$ 。
*   误差向量  $e=b-A\hat x$  最小： $\|e\|=\min$ .

### 2.2 当  $r=m<n$ （Wide matrix, 行独立）

*   方程有 **无限解**。
*   伪逆给出 **最短长度解**  $x^{+}=A^{+}b$ ，其零空间部分为 0。
*   任一解可写  $x=x^{+}+x_n$ ，加任何  $x_n\in N(A)$  增大  $\|x\|$ 。

### 2.3 **总结性定理**

> ** $x^{+}=A^{+}b$  是“最小范数的最小二乘解”**
> 
> *   在所有使  $\|Ax-b\|$  达到最小的向量中， $x^{+}$  还最小化  $\|x\|$ 。
> *   因此同时解决误差与长度两重最优。
>     

* * *

3 伪逆的计算途径（预告）
-------------

1.  **从 QR 或 CR 分解**
    $$
    A=QR \quad\Rightarrow\quad A^{+}=R^{-1}Q^{\mathsf T}; \qquad A=CR \quad(C\text{列正交})\,.
    $$
2.  **从 SVD（后续章节）**
    $$
    A=U\Sigma V^{\mathsf T}\;\Rightarrow\; A^{+}=V\Sigma^{+}U^{\mathsf T}\quad (\Sigma^{+}\text{对非零奇异值取倒数})。
    $$

* * *

4 流程串联与四大子空间
------------

*   **左逆情形（本章主角）**
    $$
    A^{\mathsf T}A\text{ 可逆 }\Longrightarrow \hat x=A^{+}b,\quad p=A\hat x\in C(A),\; e=b-p\in N(A^{\mathsf T}).
    $$
*   **零空间拆分**  
    任意向量  $x$  可分为行空间分量  $x^{+}$  与零空间分量  $x_n$ 。伪逆把  $x_n$  剪掉。

* * *

5 易混提醒
------

| 错误思路 | 正确观念 |
| --- | --- |
| “左逆/右逆就是  $A^{-1}$ ” | 仅一侧成立，另一侧不成立，且一般仅满秩长/宽矩阵可行。 |
| “伪逆只为无解系统用” | 有多解时亦用伪逆选最短范数；全秩方阵伪逆=真逆。 |
| “ $(A^{\mathsf T}A)^{-1}A^{\mathsf T}$  永远可逆分解” | 当  $A^{\mathsf T}A$  奇异（列相关）时 **不可行**，须用 SVD 版本。 |

* * *

6 小结
----

1.  **伪逆统一** 左逆、右逆、真逆。
2.  **最小误差 + 最小范数** = 伪逆解  $x^{+}$ 。
3.  **列独立 → 左逆**、**行独立 → 右逆**；两者皆缺仍可用 SVD 伪逆。
4.  后续章节将给出 **SVD 计算法** 与 **数值稳健性** 讨论。



![image-20250804044845403](./assets/image-20250804044845403.png)

![image-20250804044937423](./assets/image-20250804044937423.png)



4.5 矩阵的伪逆  $A^{+}$ ——“无论能不能求逆，都能给你**最好**的解”
===========================================

> 本节要解决：当矩阵  $A$  **不能**或**不必**求真逆时，怎样用 **伪逆**  $A^{+}$  得到
> 
> 1.  最小二乘误差  $\|Ax-b\|$  最小的解；
> 2.  同时使解的长度  $\|x\|$  也尽可能短。
>     
> 
> **核心口号**：
> 
> $$
> x^{+}=A^{+}b \quad\Longrightarrow\quad \text{既最小}\;\|Ax-b\|,\;\text{又最小}\;\|x\|.
> $$

* * *

详细拆解
----

### 1\. 单、双侧逆与伪逆

| 场景 | 条件 | 左逆  $(A^{+}A=I)$  | 右逆  $(AA^{+}=I)$  | 伪逆 |
| --- | --- | --- | --- | --- |
| **满秩方阵**  $r=m=n$  | 真逆存在 | ✓ | ✓ |  $A^{+}=A^{-1}$  |
| **列独立**  $r=n<m$   
“瘦高” |  $A^{\mathsf T}A$  可逆 | ✓  $(A^{+}=(A^{\mathsf T}A)^{-1}A^{\mathsf T})$  | ✗ | 最小二乘、误差不可避 |
| **行独立**  $r=m<n$   
“矮宽” |  $AA^{\mathsf T}$  可逆 | ✗ | ✓  $(A^{+}=A^{\mathsf T}(AA^{\mathsf T})^{-1})$  | 多解→取最短 |
| **秩低于  $\min(m,n)$ ** | 两侧皆缺 | ✗ | ✗ | 用 SVD 得一般  $A^{+}$  |

> 伪逆统一了一切：无论是否单侧可逆，总能给出 **最小误差且最短长度** 的  $x^{+}$ 。

* * *

### 2\. 四大子空间的“翻转镜像”——Figure 4.11

*   **任何向量**  $y$  可分  $y=b+z$ ：
    *    $b\in C(A)$ （列空间），
    *    $z\in N(A^{\mathsf T})$ （左零空间）。
*   **伪逆动作**
    *    $A^{+}b = x$  → 把列空间中的  $b$  “拉回” 行空间得到  $x$ 。
    *    $A^{+}z = 0$  → 左零空间部分直接杀掉。
*   **投影矩阵**
    $$
    P_{\rm row}=A^{+}A,\quad P_{\rm col}=AA^{+},
    $$
    分别是到**行空间**与**列空间**的正交投影，且
    $$
    P_{\rm row}^2=P_{\rm row}^{\mathsf T}=P_{\rm row}, \qquad P_{\rm col}^2=P_{\rm col}^{\mathsf T}=P_{\rm col}.
    $$

* * *

### 3\. 伪逆的极简例子

#### 例 1 秩 1 的对角矩阵

$$
A=\begin{bmatrix}2&0\\0&0\end{bmatrix},\qquad A^{+}=\begin{bmatrix}1/2&0\\0&0\end{bmatrix}.
$$

> 非零对角元取倒数；零元保持 0。  
> 这思想推广到 **任何**奇异对角（或 SVD 的奇异值）矩阵。

#### 例 2 列向量  $A=[1\;1]^{\mathsf T}$ 

*   左逆不存在，右逆为
    $$
    A^{+}=\tfrac12[\,1\;1\,].
    $$
*   验证：  $AA^{+}=1$ （右逆），但  $A^{+}A\ne 1$ 。

* * *

### 4\. 用 QR／CR／SVD 求伪逆

*   **QR（列独立）**： $A=QR \Rightarrow A^{+}=R^{-1}Q^{\mathsf T}$ 。
*   **CR（行独立）**： $A=CR \Rightarrow A^{+}=R^{\mathsf T}(CRR^{\mathsf T})^{-1}$ 。
*   **SVD（通用）**： $A=U\Sigma V^{\mathsf T}\Rightarrow A^{+}=V\Sigma^{+}U^{\mathsf T}$ 。
    *    $\Sigma^{+}$ ：非零奇异值取倒数，其余置零。

* * *

### 5\. 关键结论一语破

> **伪逆  $A^{+}$  选的是——“行空间部分原样拉回，左零空间部分归零”。**  
> 因此
> 
> *   误差最小（所有最小二乘解中）
> *   长度最短（把零空间分量剔除）
>     

* * *

小结
--

1.  **伪逆存在且唯一**，覆盖真逆、左逆、右逆所有情形。
2.   $x^{+}=A^{+}b$  ⇒ **最小二乘 + 最小范数** 双料最优。
3.  投影矩阵  $A^{+}A$  与  $AA^{+}$  分别投到行/列空间。
4.  计算伪逆最稳健的方法是 **SVD**；QR/CR 在列独立或行独立时同样高效。



![image-20250804044947058](./assets/image-20250804044947058.png)

![image-20250804044951866](./assets/image-20250804044951866.png)

## Response:
矩阵伪逆  $A^{+}$  的四维全景
====================

（对应课件 4.5 最后两页）

* * *

一、标题与内容概览
---------

**标题**：伪逆的“行-列镜像”与  $A=CR \Rightarrow A^{+}=R^{+}C^{+}$   
**概况**：

1.  伪逆把 **行空间 ↔ 列空间** 成对映射，并生成正交投影  $P_{\text{row}}=A^{+}A$ 、 $P_{\text{col}}=AA^{+}$ 。
2.  通过 **精简行列** 的分解  $A=CR$ （ $C$  取列基、 $R$  取行基）可直接写出
    $$
    A^{+}=R^{+}C^{+}=R^{\mathsf T}(C^{\mathsf T}AR^{\mathsf T})^{-1}C^{\mathsf T}.
    $$
3.  Moore-Penrose 四条件  $(5)$  唯一确定伪逆：
    $$
    AA^{+}A=A,\;A^{+}AA^{+}=A^{+},\;(A^{+}A)^{\mathsf T}=A^{+}A,\;(AA^{+})^{\mathsf T}=AA^{+}.
    $$

* * *

二、分块图（Figure 4.11）深度解析
----------------------

| 区域 | 作用 | 伪逆效果 |
| --- | --- | --- |
| **列空间  $C(A)$ ** |  $b=Ax$  的全部可能 |  $A^{+}$  把  $b$  拉回到行空间： $x=A^{+}b$ 。 |
| **行空间  $C(A^{\mathsf T})$ ** | 投影坐标的存放处 |  $A^{+}A= P_{\text{row}}=\begin{bmatrix}I&0\\0&0\end{bmatrix}$ 。 |
| **零空间  $N(A)$ ** | 解的自由度 | 伪逆置零： $A^{+}z=0$ 。 |
| **左零空间  $N(A^{\mathsf T})$ ** | 误差向量所在 | 误差直接消失： $AA^{+}y=b$ 。 |

> **关键观测**：若  $x,X\in C(A^{\mathsf T})$  且  $Ax=AX$ ，二者之差即落入  $N(A)\cap C(A^{\mathsf T})=\{0\}$  ⇒ **行空间到列空间映射是单射**，伪逆正好反向实现同构。

* * *

三、CR 分解与伪逆公式
------------

1.  **回忆 CR**
    *   先用高斯消元取出 **列透视索引** →  $C\in\mathbb R^{m\times r}$ （独立列）。
    *   再取 **行独立行** →  $R\in\mathbb R^{r\times n}$ 。
    *   于是  $A=CR$ 。两个子矩阵皆满秩。
2.  **单侧逆**
    $$
    C^{+}=(C^{\mathsf T}C)^{-1}C^{\mathsf T},\quad R^{+}=R^{\mathsf T}(RR^{\mathsf T})^{-1}.
    $$
3.  **组合成  $A^{+}$ **  
    顺序必须是 **右逆  $R^{+}$ ** 乘 **左逆  $C^{+}$ **：
    $$
    \boxed{A^{+}=R^{+}C^{+}=R^{\mathsf T}(RR^{\mathsf T})^{-1}(C^{\mathsf T}C)^{-1}C^{\mathsf T}}
    $$
    与 QR、SVD 得到的伪逆完全相同。

* * *

四、Penrose 四条件 (5) 与投影
---------------------

*   满足 (5) 即唯一伪逆。
*   由 (5) 推得
    $$
    P_{\text{row}}=A^{+}A,\quad P_{\text{col}}=AA^{+}
    $$
    **二者都是对称幂等矩阵**，分别投影到行空间与列空间。

* * *

五、例题与性质补充
---------

| 例题 | 知识点 | 结论 |
| --- | --- | --- |
| **对角矩阵**  $D=\operatorname{diag}(2,3,0)$  | 非零元取倒数，零元保 0 |  $D^{+}=\operatorname{diag}(1/2,1/3,0)$  |
| **列向量**  $A=[1\;1]^{\mathsf T}$  | 列独立、行相关 | 左逆缺失；右逆  $A^{+}=\tfrac12[1\;1]$  |
| **行向量**  $A=[1\;1]$  | 行独立、列相关 | 左逆  $A^{+}=\tfrac12\begin{bmatrix}1\\1\end{bmatrix}$ ；右逆缺失 |

* * *

六、结语与展望
-------

*   伪逆  $A^{+}$  **统一** 左逆/右逆/真逆三类情形，是“最小二乘 + 最小范数”双料最优解。
*   任取分解  $A=QR$ 、 $A=CR$ 、或 **SVD**  $A=U\Sigma V^{\mathsf T}$  都可高效计算同一  $A^{+}$ 。
*   下一章（第 7 章）将以 **奇异值分解 SVD** 绘制更强大的正交基（奇异向量）框架，伪逆将自然掉落为  $\Sigma^{+}$  的倒数替换。



![image-20250804044956739](./assets/image-20250804044956739.png)

![image-20250804045000551](./assets/image-20250804045000551.png)



4.5 伪逆的工程范例 —— **图的关联矩阵 (Incidence Matrix) 与 A⁺**
-------------------------------------------------

> 这一页把抽象的 “A 的四个子空间 + 伪逆” 落到 **网络流 / 电路** 的具体矩阵上。  
> 我们将沿用课件笔记格式：先概览主题，再逐行拆解公式 (6)–(9) 与图 4.11 中的论证，最后总结核心洞察。

* * *

### 1 标题与概况

**标题**：关联矩阵伪逆的构造与性质 —— 从 CR 分解到 A⁺  
**概况**：

1.  **关联矩阵 A**
    *   行：**边 (m = 5)** 列：**节点 (n = 4)** → rank _r = 3_
    *   每行只有  $-1,1$  两值： $-1$  离开节点， $+1$  进入节点。
2.  **列独立 & 行独立** 皆不满足 ⇒ **不可逆**；需用 **伪逆  $A^{+}$ **。
3.  采用 **列基 C ＋ 行基 R** 的 **CR** 分解，推导公式
    $$
    A^{+}=R^{\mathsf T}\bigl(C^{\mathsf T}AR^{\mathsf T}\bigr)^{-1}C^{\mathsf T}.
    $$
4.  具体算出  $A^{+}$  后，验证 Moore–Penrose 四条件与投影矩阵性质。

* * *

### 2 知识点与公式深解

#### 2.1 图与关联矩阵

*   **构图**：五条有向边  $a,b,c,d,e$  连接四个节点  $1,2,3,4$ 。
*   **矩阵表示**
    
$$
A=\begin{bmatrix} -1 & 1 & 0 & 0\\ -1 & 0 & 1 & 0\\ 0 & -1 & 1 & 0\\ -1 & 0 & 0 & 1\\ 0 & -1 & 0 & 1 \end{bmatrix}, \qquad m=5,\;n=4,\;r=\operatorname{rank}A=3.
$$

> **列 4** 是  $-(\text{列1+列2+列3})$  ⇒ 线性相关，rank 缺 1。

* * *

#### 2.2 CR 分解 (列基 × 行基) —— 公式 (6)

$$
A=CR,\quad C=\begin{bmatrix} -1&1&0\\ -1&0&1\\ 0&-1&1\\ -1&0&0\\ 0&-1&0 \end{bmatrix}_{\!5\times3}, \quad R=\begin{bmatrix} 1&0&0&-1\\ 0&1&0&-1\\ 0&0&1&-1 \end{bmatrix}_{\!3\times4}.
$$
*   **C**：取自 A 的前三列（独立）。
*   **R**：用初等行变换把 A 的前三列化为单位阵，记录其对 A 的作用；第四列  $[-1,-1,-1]^{\mathsf T}$  放在最后一列。
*   **优点**：尺寸 r×r 的核心块  $C^{\mathsf T}AR^{\mathsf T}=C^{\mathsf T}C$  易逆。

* * *

#### 2.3 伪逆公式 (7)

$$
A^{+}=R^{+}C^{+}=R^{\mathsf T}\bigl(C^{\mathsf T}AR^{\mathsf T}\bigr)^{-1}C^{\mathsf T}.
$$
*   **C^{+}** 为左逆： $(C^{\mathsf T}C)^{-1}C^{\mathsf T}$ 。
*   **R^{+}** 为右逆： $R^{\mathsf T}(RR^{\mathsf T})^{-1}$ 。
*   顺序必须 **右逆乘左逆** (R⁺C⁺)，才能满足一侧逆条件。

* * *

#### 2.4 实际计算

1.  **核心 3×3 矩阵**
    $$
    C^{\mathsf T}AR^{\mathsf T}=C^{\mathsf T}C= \begin{bmatrix} 4&0&0\\ 0&4&0\\ -1&-1&2 \end{bmatrix}.
    $$
2.  **求逆并代入 (7)**，得
    $$
    A^{+}= \tfrac18 \begin{bmatrix} -2&-2&0&-2&0\\ 2&\;\;0&-2&0&-2\\ 0&\;\;3&-\!3& -1&-1\\ 0&-1&-\!1&\;3&\;3 \end{bmatrix}_{\!4\times5}. \tag{9}
    $$

* * *

#### 2.5 验证 Penrose 四条件 (5)

*   直接带入 (8)
    $$
    (A^{+}A)^2=A^{+}A,\qquad (AA^{+})^2=AA^{+},
    $$
    或以数值检验，满足对称幂等 ⇒ 确为唯一伪逆。
*   **行/列空间投影**
    *    $P_{\text{row}}=A^{+}A$  把 5 维边流降到 3 维环流。
    *    $P_{\text{col}}=AA^{+}$  把节点势差投回可实现的边流。

* * *

### 3 物理意义 —— Kirchhoff 电流定律 (KCL)

*   **A 的行和 = 0** ⇒ 每列元素之和为 0（节点守恒）。
*   ** $A^{\mathsf T}y=0$  = KCL**：边流 y 满足入流=出流。
*   ** $A^{+}$ ** 在电路分析中即 **网络灵敏度矩阵**（图 Laplacian 的广义逆）。

* * *

### 4 推荐算法 —— SVD 更稳健

$$
A=U\Sigma V^{\mathsf T}\;\Longrightarrow\; A^{+}=V\Sigma^{+}U^{\mathsf T},
$$
*   对大型或浮点矩阵：奇异值 0 → 取 0，非零取倒数 ⇒ 数值可控。
*   **CR** 对小整型矩阵方便，避免浮点开方；两种方法得到 **同一 A⁺**。

* * *

### 5 小结

1.  **CR 分解** 给出伪逆的显式有理式，不含 SVD 的平方根。
2.  **A⁺ 映射**：
    *   行空间 ↔ 列空间一一对应；
    *   零空间 / 左零空间分量被抹去。
3.  **四条件 (5)** 保证 A⁺ 唯一且投影为对称幂等。
4.  **网络流 / 电路**：关联矩阵伪逆连接节点电位、边流与回路流，是计算机工程与图论中的核心工具。



![image-20250804045006165](./assets/image-20250804045006165.png)

## Response:
思考正交性的胜利
--------

> ——第 4 章收官（课件 “Thoughts on the Victory of Orthogonality”）学习笔记

* * *

### 1\. 内容概览

在回顾整本《线性代数及其应用》到目前为止的所有章节后，作者列出 **9 条** “正交向量 / 正交矩阵” 的关键胜利，说明正交概念为何处处制胜、为何值得我们在投影、最小二乘、QR、SVD 中千锤百炼。

* * *

### 2\. 九大胜利逐条解析

| # | 原文要点 | 详细解析与上下文衔接 |
| --- | --- | --- |
| **1** |  $\|Qx\|=\|x\|$  | 正交矩阵保持向量长度（欧几里得范数不变）。因此在数值运算中不会放大舍入误差；在图形旋转、信号处理中更是“保能量”根基。 |
| **2** |  $(Qx)^{\mathsf T}(Qy)=x^{\mathsf T}y$  | 保内积 ⇒ 同时保持角度；正交矩阵是**刚体变换**（旋转 / 反射 / 置换）在线性代数中的抽象。 |
| **3** | 列空间投影  $P=QQ^{\mathsf T}=(QQ^{\mathsf T})^2$  | 与投影矩阵章节呼应：若基向量已正交归一，投影只需一次乘法，无需  $(A^{\mathsf T}A)^{-1}$ 。 |
| **4** | 最小二乘解  $\hat x=Q^{\mathsf T}b$  | 对 “瘦高”  $m>n$  且列正交的  $Q$ ，正规方程直接化为点积；加上伪逆定义得  $\hat x=Q^{\mathsf T}b$ 。 |
| **5** | 若  $Q$  方阵 ⇒  $Q^{\mathsf T}=Q^{-1}$  | 进一步简化矩阵运算；行列式 ( |
| **6** | 对称矩阵可选正交特征向量 | 第 6 章内容预告：实对称  $S$  可对角化  $Q^{\mathsf T}SQ=\Lambda$ 。 |
| **7** | 任意矩阵的奇异向量正交 | 第 7 章 SVD 预告， $A=U\Sigma V^{\mathsf T}$  中  $U,V$  列均正交。 |
| **8** | 每个可逆矩阵  $A=QS$ （Q 正交, S 对称正定） | 即 **极分解** (Polar Decomposition)；示例把  $\begin{bmatrix}3&0\\4&5\end{bmatrix}$  拆为  $Q\sqrt5S$ 。 |
| **9** | 每个可逆矩阵  $A=QR$ （Q 正交, R 上三角） | **Gram–Schmidt** 产物。上三角  $R$  保存尺度与剪切， $Q$  保存旋转/反射，二者分工明确。 |

* * *

### 3\. 正交成功的根本原因

*   **平方和长度  $\|x\|^2=x^{\mathsf T}x$ ** 的定义与正交性天然契合。
*   最小二乘的梯度  $\nabla\|Ax-b\|^2=2A^{\mathsf T}(Ax-b)$  直接构造了对称矩阵  $A^{\mathsf T}A$ ，可由正交矩阵对角化。
*   因此在误差度量、可对角化、数值稳定三条主线上，正交都占据中心。

* * *

### 4\. 进一步的正交矩阵故事

1.  **双正交对角化**
    *   任意矩阵  $A$  可由 **两** 个正交矩阵  $U,V$  对角化成 SVD： $U^{\mathsf T}AV=\Sigma$ 。
2.  **determinant = ±1**
    *   正交矩阵乘法闭合；所有正交矩阵的行列式恒为 ±1，保体积。
3.  **幂与连乘仍正交**
    *   任意  $Q_1\cdots Q_k$  仍满足  $Q^{\mathsf T}Q=I$ ，行列式仍 ±1，这让组合旋转、反射都在正交群内部完成。

* * *

### 5\. 两个示例补充（课件 Example 8 & 9）

| 示例 |  $A$  | 分解 | 解读 |
| --- | --- | --- | --- |
| **Example 8** |  $ \begin{bmatrix}3&0\\4&5\end{bmatrix}$  |  $A=QS$  ： $Q=\frac1{\sqrt5}\!\begin{bmatrix}2&-1\\1&2\end{bmatrix},\;S=\sqrt5\!\begin{bmatrix}2&1\\1&2\end{bmatrix}$  | Polar Decomp，把伸缩/剪切归入正定  $S$ ，旋转归  $Q$ 。 |
| **Example 9** | 同一个  $A$  |  $A=QR$ ： $Q=\frac1{5}\begin{bmatrix}3&-4\\4&3\end{bmatrix},\;R=\begin{bmatrix}5&4\\0&3\end{bmatrix}$  | QR 来自 Gram–Schmidt，第 4.4 节已详细推导。 |

* * *

### 6\. 总结

*   **正交基线** 一线贯穿：投影 → 最小二乘 → QR → SVD → 特征分解。
*   **胜利宣言**：选择正交向量/矩阵即可把内积、长度、方程求解、数值稳定全部一网打尽。
*   接下来的第 6、7 章将把正交性推向极致：
    1.  对称矩阵固有的正交特征向量；
    2.  任意矩阵的奇异向量（左右正交）给出最完美的基。



